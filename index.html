<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù†Ø³Ø® Ø§Ù„ØªØ§Ø±ÙŠØ®</title>
<style>
  body{font-family:"Tahoma";background:#111;color:#fff;text-align:center}
  .container{margin-top:20px}
  #output{margin:10px;padding:10px;border:1px solid #555;min-height:40px}
  #history{border:1px solid #888;margin:20px auto;padding:10px;width:80%;height:auto;max-height:300px;overflow-y:auto;display:flex;flex-direction:column;gap:5px}
  .btn{padding:6px 12px;margin:5px;cursor:pointer;border:none;border-radius:8px}
  #copyAllBtn{background:#2a2}
  #toggleOrientation{background:#28a}
  #stopBtn{background:#a22;display:none}
</style>
</head>
<body>
<div class="container">
  <button id="startBtn" class="btn">ğŸ¤ Ø¨Ø¯Ø¡</button>
  <button id="stopBtn" class="btn">â¹ Ø¥ÙŠÙ‚Ø§Ù</button>
  <button id="copyAllBtn" class="btn">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙ„</button>
  <button id="toggleOrientation" class="btn">â†” ØªØ­ÙˆÙŠÙ„</button>
  <div id="recordingIndicator" style="display:none;color:red">ğŸ”´ ØªØ³Ø¬ÙŠÙ„...</div>
  <div id="output"></div>
  <div id="history"></div>
</div>

<script>
let recognition;
let isHorizontal=false;

function wordsToNumbersInText(text){
  const units={"ØµÙØ±":0,"ÙˆØ§Ø­Ø¯":1,"ÙˆØ§Ø­Ø¯Ø©":1,"Ø§Ø«Ù†Ø§Ù†":2,"Ø§Ø«Ù†ÙŠÙ†":2,"Ø«Ù„Ø§Ø«Ø©":3,"Ø«Ù„Ø§Ø«":3,"Ø§Ø±Ø¨Ø¹Ø©":4,"Ø£Ø±Ø¨Ø¹Ø©":4,"Ø®Ù…Ø³Ø©":5,"Ø³ØªØ©":6,"Ø³Ø¨Ø¹Ø©":7,"Ø«Ù…Ø§Ù†ÙŠØ©":8,"ØªØ³Ø¹Ø©":9};
  const teens={"Ø¹Ø´Ø±Ø©":10,"Ø§Ø­Ø¯Ù‰ Ø¹Ø´Ø±":11,"Ø¥Ø­Ø¯Ù‰ Ø¹Ø´Ø±":11,"Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±":12,"Ø¥Ø«Ù†Ø§ Ø¹Ø´Ø±":12,"Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±":13,"Ø§Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±":14,"Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±":14,"Ø®Ù…Ø³Ø© Ø¹Ø´Ø±":15,"Ø³ØªØ© Ø¹Ø´Ø±":16,"Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±":17,"Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±":18,"ØªØ³Ø¹Ø© Ø¹Ø´Ø±":19};
  const tens={"Ø¹Ø´Ø±ÙˆÙ†":20,"Ø¹Ø´Ø±ÙŠÙ†":20,"Ø«Ù„Ø§Ø«ÙˆÙ†":30,"Ø«Ù„Ø§Ø«ÙŠÙ†":30,"Ø§Ø±Ø¨Ø¹ÙˆÙ†":40,"Ø£Ø±Ø¨Ø¹ÙˆÙ†":40,"Ø§Ø±Ø¨Ø¹ÙŠÙ†":40,"Ø£Ø±Ø¨Ø¹ÙŠÙ†":40,"Ø®Ù…Ø³ÙˆÙ†":50,"Ø®Ù…Ø³ÙŠÙ†":50,"Ø³ØªÙˆÙ†":60,"Ø³ØªÙŠÙ†":60,"Ø³Ø¨Ø¹ÙˆÙ†":70,"Ø³Ø¨Ø¹ÙŠÙ†":70,"Ø«Ù…Ø§Ù†ÙˆÙ†":80,"Ø«Ù…Ø§Ù†ÙŠÙ†":80,"ØªØ³Ø¹ÙˆÙ†":90,"ØªØ³Ø¹ÙŠÙ†":90};
  const hundreds={"Ù…Ø§Ø¦Ø©":100,"Ù…Ø¦Ø©":100,"Ù…ÙŠØ©":100,"Ù…Ø¦ØªÙŠÙ†":200,"Ù…ÙŠØªÙŠÙ†":200,"Ø«Ù„Ø§Ø«Ù…Ø§Ø¦Ø©":300,"Ø«Ù„Ø§Ø«Ù…ÙŠØ©":300,"Ø£Ø±Ø¨Ø¹Ù…Ø§Ø¦Ø©":400,"Ø§Ø±Ø¨Ø¹Ù…Ø§ÙŠØ©":400,"Ø®Ù…Ø³Ù…Ø§Ø¦Ø©":500,"Ø®Ù…Ø³Ù…Ø§ÙŠØ©":500,"Ø³ØªÙ…Ø§Ø¦Ø©":600,"Ø³ØªÙ…ÙŠØ©":600,"Ø³Ø¨Ø¹Ù…Ø§Ø¦Ø©":700,"Ø³Ø¨Ø¹Ù…ÙŠØ©":700,"Ø«Ù…Ø§Ù†Ù…Ø§Ø¦Ø©":800,"Ø«Ù…Ø§Ù†Ù…ÙŠØ©":800,"ØªØ³Ø¹Ù…Ø§Ø¦Ø©":900,"ØªØ³Ø¹Ù…ÙŠØ©":900};
  const multipliers={"Ø£Ù„Ù":1000,"Ø§Ù„Ù":1000,"Ø£Ù„ÙÙŠÙ†":2000,"Ø§Ù„ÙÙŠÙ†":2000,"Ø¢Ù„Ø§Ù":1000,"Ù…Ù„ÙŠÙˆÙ†":1000000,"Ù…Ù„Ø§ÙŠÙŠÙ†":1000000};
  const allWords=Object.assign({},units,teens,tens,hundreds,multipliers);

  const tokens=text.replace(/ØŒ/g," ").replace(/ Ùˆ /g," ").trim().split(/\s+/);
  let resultWords=[]; let numberBuffer=[];

  function processBuffer(buffer){
    let total=0; let current=0;
    buffer.forEach(word=>{
      if(teens[word]!==undefined) current+=teens[word];
      else if(units[word]!==undefined) current+=units[word];
      else if(tens[word]!==undefined) current+=tens[word];
      else if(hundreds[word]!==undefined) current+=hundreds[word];
      else if(multipliers[word]!==undefined){
        if(multipliers[word]>=1000){
          current=(current===0?1:current)*multipliers[word];
          total+=current;current=0;
        } else current*=multipliers[word];
      }
    });
    total+=current;
    return total.toString();
  }

  for(let i=0;i<tokens.length;i++){
    const word=tokens[i];
    const twoWords=word+" "+(tokens[i+1]||"");
    if(teens[twoWords]){numberBuffer.push(twoWords);i++;continue;}
    if(allWords[word]) numberBuffer.push(word);
    else {
      if(numberBuffer.length>0){
        resultWords.push(processBuffer(numberBuffer));
        numberBuffer=[];
      }
      resultWords.push(word);
    }
  }
  if(numberBuffer.length>0) resultWords.push(processBuffer(numberBuffer));
  return resultWords.join(" ");
}

function startRecognition(){
  const SpeechRecognition=window.webkitSpeechRecognition;
  if(!SpeechRecognition){alert("âŒ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØªØ¹Ù…Ù„ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ù…ØªØµÙØ­ Chrome.");return;}
  recognition=new SpeechRecognition();
  recognition.lang='ar-IQ';
  recognition.interimResults=false;
  recognition.onstart=function(){
    document.getElementById("recordingIndicator").style.display="block";
    document.getElementById("startBtn").style.display="none";
    document.getElementById("stopBtn").style.display="inline-block";
  }
  recognition.onresult=function(event){
    const transcript=event.results[0][0].transcript;
    const converted=wordsToNumbersInText(transcript);
    document.getElementById("output").innerText=converted;
    addHistoryLine(converted,true);
  }
  recognition.onend=function(){
    document.getElementById("recordingIndicator").style.display="none";
    document.getElementById("startBtn").style.display="inline-block";
    document.getElementById("stopBtn").style.display="none";
  }
  recognition.start();
}
function stopRecognition(){if(recognition) recognition.stop();}

// === history ===
const historyDiv=document.getElementById("history");

function addHistoryLine(text,isAuto=false){
  const div=document.createElement("div");
  div.style.position="relative";
  div.style.paddingLeft="10px";
  div.style.cursor="pointer";
  div.style.direction="rtl";     // Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ†
  div.style.unicodeBidi="plaintext"; // Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±

  // Ø§Ù„Ù†Øµ Ù†ÙØ³Ù‡
  const span=document.createElement("span");
  span.textContent=text;
  div.appendChild(span);

  div.onclick=function(){
    navigator.clipboard.writeText(span.textContent);
    const notif=document.createElement("span");
    notif.textContent="âœ” ØªÙ… Ø§Ù„Ù†Ø³Ø®";
    notif.style.position="absolute";
    notif.style.left="-90px";
    notif.style.top="0";
    notif.style.color="#0f0";
    div.appendChild(notif);
    setTimeout(()=>notif.remove(),1500);
  };

  historyDiv.appendChild(div);
  historyDiv.scrollTop=historyDiv.scrollHeight;

  if(isAuto){
    navigator.clipboard.writeText(span.textContent);
  }
}

// === Ù†Ø³Ø® Ø§Ù„ÙƒÙ„ ===
document.getElementById("copyAllBtn").onclick=function(){
  const allText=[...historyDiv.children].map(c=>c.querySelector("span").textContent).join("\n");
  navigator.clipboard.writeText(allText);
}

// === ØªØ­ÙˆÙŠÙ„ Ø¹Ù…ÙˆØ¯ÙŠ/Ø£ÙÙ‚ÙŠ ===
document.getElementById("toggleOrientation").onclick=function(){
  isHorizontal=!isHorizontal;
  historyDiv.style.display="flex";
  historyDiv.style.flexDirection=isHorizontal?"row":"column";
  historyDiv.style.flexWrap=isHorizontal?"wrap":"nowrap";
}
</script>
</body>
</html>
