<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Convert audio</title>
<style>
/* === التنسيقات الأصلية مع تعديل زر الكلمات الذكية === */
body{margin:0;padding:0;background-color:#000;color:#fff;font-family:Tahoma,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column}
.login-container{background-color:#111;padding:30px;border-radius:12px;box-shadow:0 0 20px rgba(255,255,255,0.15);text-align:center;width:90%;max-width:400px;display:none}
.login-container h2{margin-bottom:20px;font-size:22px;color:#ffcc00}
.login-container input{width:90%;padding:12px;margin:10px 0;border-radius:8px;border:1px solid #444;background-color:#1a1a1a;color:#fff;font-size:16px;text-align:center;direction:ltr;unicode-bidi:embed}
.login-container label{font-size:14px;display:inline-block;align-items:center;justify-content:center;gap:1px;margin-top:10px;cursor:pointer;width:-55℅;text-align:center;position:relative;top:11px}
.login-container button{padding:12px 24px;font-size:18px;margin-top:15px;border:none;border-radius:8px;background-color:#4CAF50;color:white;cursor:pointer;transition:0.3s}
.login-container button:hover{opacity:0.85}
.container{background-color:#111;padding:28px;border-radius:12px;box-shadow:0 0 20px rgba(255,255,255,0.1);text-align:center;width:90%;max-width:600px;transition:all 0.3s ease;display:none;position:relative}
h1{font-family:bodoni,cursive; color:rgba(196, 144, 217, 0.70); margin-bottom:20px;font-size:25px;transition:font-size 0.3s ease}
button{padding:12px 24px;font-size:18px;margin:0px 0px;border:none;border-radius:8px;cursor:pointer;transition:0.3s,font-size 0.3s ease,padding 0.3s ease}
#startBtn{background-color:#4CAF50;color:white}
#stopBtn{background-color:#f44336;color:white;display:none}
button:hover{opacity:0.85}
#recordingIndicator{display:none;color:#ff5252;font-weight:bold;margin-top:10px}
#recordingDot{display:inline-block;width:12px;height:12px;background-color:red;border-radius:50%;margin-left:8px;animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
#output{background:#222;border:1px solid #444;padding:15px;border-radius:8px;margin-top:20px;font-size:18px;min-height:80px;white-space:pre-wrap;color:#ddd;transition:font-size 0.3s ease,padding 0.3s ease;direction:ltr;unicode-bidi:embed;text-align:center;position:relative;user-select:none}
#outputText{pointer-events:none} 
textarea{width:96%;margin-top:15px;padding:12px;font-size:16px;border-radius:6px;border:1px solid #555;background-color:#1a1a1a;color:#fff;resize:vertical;transition:font-size 0.3s ease,padding 0.3s ease}
#userCountContainer{top:-22px;left:15px;right:15px;display:flex;align-items:center;font-size:13px;opacity:0.8;justify-content:space-between}
#userCount{color:#0f0}
#logoutBtn{font-size:12px;padding:4px 8px;border-radius:6px;border:none;background-color:#f44336;color:white;cursor:pointer;opacity:0.9}
footer{margin-top:15px;font-size:14px;color:#b17215;text-align:center}
@keyframes rgbGlow{0%{box-shadow:0 0 40px 15px rgba(255,0,0,0.25)}20%{box-shadow:0 0 40px 15px rgba(255,165,0,0.25)}40%{box-shadow:0 0 40px 15px rgba(0,255,0,0.25)}60%{box-shadow:0 0 40px 15px rgba(0,255,255,0.25)}80%{box-shadow:0 0 40px 15px rgba(0,0,255,0.25)}100%{box-shadow:0 0 40px 15px rgba(255,0,255,0.25)}}
.container.recording{animation:rgbGlow 10s infinite linear}

/* === تعديل زر الكلمات الذكية === */
#smartWordsBtn {
    position: absolute;
    top: 5px;
    left: 5px;
    padding: 4px 8px;
    font-size: 12px;
    background-color: #564d4d;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    z-index: 50;
}
#smartWordsMenu {
    position: absolute;
    top: 35px;
    left: 5px;
    background: #222;
    border: 1px solid #555;
    border-radius: 6px;
    padding: 6px;
    display: none;
    flex-direction: column;
    gap: 4px;
    z-index: 51;
}
.smartWordItem{display:flex;justify-content:space-between;align-items:center;background:#333;padding:2px 6px;border-radius:4px;cursor:pointer}
.smartWordItem span{flex:1;text-align:center}
.smartWordItem button{background:red;color:#fff;border:none;border-radius:4px;padding:0 4px;margin-left:4px;cursor:pointer}
#smartAddInput{display:flex;gap:4px;margin-bottom:4px}
#smartAddInput input{flex:1;padding:4px;border-radius:4px;border:1px solid #555;background:#111;color:#fff;font-size:14px}
#smartAddInput button{padding:4px 8px;border-radius:4px;border:none;background:#4CAF50;color:#fff;font-size:12px;cursor:pointer}

/* === زر القائمة العلوية === */
#menuBtn{
    position: absolute;
    top: 10px;
    left: 10px;
    padding: 6px 12px;
    font-size: 14px;
    border-radius: 6px;
    border: none;
    background-color: #444;
    color: #fff;
    cursor: pointer;
    z-index: 1000;
}
#menuDropdown{
    position: absolute;
    top: 42px;
    left: 10px;
    background-color: #222;
    border: 1px solid #555;
    border-radius: 6px;
    padding: 8px;
    display: none;
    flex-direction: column;
    gap: 6px;
    z-index: 1000;
}

/* === استجابة الشاشة === */
@media (max-width:500px){.container{padding:20px}.container h1{font-size:20px}button{font-size:16px;padding:10px 18px}#output{font-size:16px;padding:12px}textarea{font-size:14px;padding:10px}}
@media (max-width:350px){.container{padding:15px}.container h1{font-size:18px}button{font-size:14px;padding:8px 16px}#output{font-size:14px;padding:10px}textarea{font-size:13px;padding:8px}}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDa1_gisk5GuTvRzACp0lA1TGe3-b2Sz8A",
  authDomain: "dragon-tv-3e8c1.firebaseapp.com",
  databaseURL: "https://dragon-tv-3e8c1-default-rtdb.firebaseio.com",
  projectId: "dragon-tv-3e8c1",
  storageBucket: "dragon-tv-3e8c1.firebasestorage.app",
  messagingSenderId: "909817368695",
  appId: "1:909817368695:web:b5e9ffccafefcbc41a7672"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>
</head>
<body>

<div class="login-container" id="login">
<h2>⟱ تسجيل الدخول ⟱</h2>
<input type="text" id="username" placeholder="اسم المستخدم">
<input type="password" id="password" placeholder="كلمة المرور">
<label><input type="checkbox" id="rememberMe">ذكرني</label>
<button onclick="checkLogin()">دخول</button>
<p id="error" style="color:red; display:none;">!! خطأ في اسم المستخدم أو كلمة المرور</p>
</div>
<div class="container" id="app">
<div id="userCountContainer">
  <div id="userCount"># الأعضاء: 0</div>
  <button id="menuBtn">☰ قائمة</button>
<div id="menuDropdown">
    <button onclick="logout()" style="padding:8px 12px;border-radius:6px;border:none;background-color:#f44336;color:white;cursor:pointer;">تسجيل خروج</button>
    <button onclick="helpModal.style.display='block'" style="padding:8px 12px;border-radius:6px;border:none;background-color:#4CAF50;color:white;cursor:pointer;">التعليمات</button>
</div>  
</div>
<br>
<h1> [ Convert Audio To Text In Iraqi ]</h1><br>
<button id="startBtn" onclick="startRecognition()">[▶︎] بدء التسجيل</button>
<button id="stopBtn" onclick="stopRecognition()">[X] إيقاف التسجيل</button>

<div id="recordingIndicator">
  <span id="recordingDot"></span> ▶︎ جاري التسجيل...
</div>

<div id="output">
  <div id="outputText"></div>
  <button id="smartWordsBtn">ادراج تصحيح</button>
  <div id="smartWordsMenu">
    <div id="smartAddInput">
      <input type="text" id="wrongWord" placeholder="أدخل الكلمة الخاطئة">
      <input type="text" id="correctWord" placeholder="أدخل التصحيح">
      <button onclick="addSmartWord()">إضافة</button>
    </div>
    <div id="smartWordsList"></div>

    <!-- أزرار التصدير والاستيراد (صغيرتان ومتناسقتان) -->
    <div style="display:flex; gap:4px; margin-top:6px; justify-content:center;">
      <button onclick="exportSmartWords()" 
              style="padding:2px 6px;background:#4CAF50;color:#fff;border:none;border-radius:4px;font-size:12px;">تصدير</button>
      
      <button onclick="document.getElementById('importFile').click()" 
              style="padding:2px 6px;background:#2196F3;color:#fff;border:none;border-radius:4px;font-size:12px;">استيراد</button>
      <input type="file" id="importFile" accept=".json" style="display:none" onchange="importSmartWords(event)">
    </div>
  </div>
</div>

<div id="historyContainer" style="width:96%; min-height:110px; max-height:200px; 
     border:1px solid #555; border-radius:6px; background:#1a1a1a; top:18px;
     position:relative; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:4px; flex-wrap:wrap;">

  <button id="toggleHistoryBtn" title="تبديل العرض" 
          style=" 
    background-color: #564d4d; position:absolute;top:5px;left:5px;padding:4px 8px;font-size:12px; z-index:10;">⇄</button>

  <button id="copyAllHistoryBtn" title="نسخ الكل" 
          style="background-color: #564d4d; position:absolute;top:5px;right:5px;padding:4px 8px;font-size:12px; z-index:10;">نسخ الكل</button>

  <div id="history" style="width:100%; display:flex; flex-direction:column; 
       gap:4px; flex-wrap:wrap; align-items:center; justify-content:flex-start; text-align:center;">
  </div>
</div>
<br>
<footer>
  &copy; DRAGON&CHEAT 2025 @
</footer>

<div id="helpModal" style="
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80%;
    max-width: 400px;
    background-color: #111;
    color: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(255,255,255,0.3);
    text-align: center;
    z-index: 10000;
">
    <h3>تعليمات الاستخدام</h3>
    <p>
        0. يجب ان يتوفر لديك مكرفون واضح وأنترنت مستقر <br>
        1. اضغط على زر ▶︎ لبدء التسجيل الصوتي.<br>
        2. اضغط على زر X لإيقاف التسجيل.<br>
        3. سيتم تحويل كلام إلى أرقام لاتنعكس لو تكلمت 
        بها بصورة مستقلة لأنها ارقام لاتينية ليست عربية.<br>
        4. يمكنك نسخ النتائج من صندوق التاريخ.<br>
        5. لتسجيل الدخول، أدخل اسم المستخدم وكلمة المرور. <br>
      ®جميع حقوق محفوظة™
    </p>
    <button onclick="helpModal.style.display='none'" 
        style="margin-top:15px;padding:8px 16px;border:none;border-radius:8px;background-color:#4CAF50;color:white;cursor:pointer;">
        إغلاق
    </button>
</div>

<script>
// === دوال Firebase + تسجيل دخول ===
function base64EncodeUnicode(str){return btoa(unescape(encodeURIComponent(str)));}
const deviceId = crypto.randomUUID();
function updateUserOnlineStatus(username,online){const ref=db.ref('onlineUsers/'+username+'/'+deviceId);if(online){ref.set(true);ref.onDisconnect().remove();}else{ref.remove();db.ref('onlineUsers/'+username).once('value',snap=>{if(!snap.exists()){db.ref('onlineUsers/'+username).remove();}});}}
db.ref('onlineUsers').on('value',snapshot=>{document.getElementById("userCount").textContent="# الأعضاء: "+snapshot.numChildren();});
function checkLogin(){const user=document.getElementById("username").value.trim();const pass=document.getElementById("password").value.trim();const remember=document.getElementById("rememberMe").checked;const encodedUser="2LnZhNin2KE=";const encodedPass="MjI0NA==";if(base64EncodeUnicode(user)===encodedUser && base64EncodeUnicode(pass)===encodedPass){if(remember)localStorage.setItem("loggedIn","true");else sessionStorage.setItem("loggedInSession","true");document.getElementById("login").style.display="none";document.getElementById("app").style.display="block";updateUserOnlineStatus(user,true);window.addEventListener("beforeunload",()=>updateUserOnlineStatus(user,false));}else{document.getElementById("error").style.display="block";}}
function logout(){const user=document.getElementById("username").value.trim();updateUserOnlineStatus(user,false);localStorage.removeItem("loggedIn");sessionStorage.removeItem("loggedInSession");document.getElementById("app").style.display="none";document.getElementById("login").style.display="block";}
window.onload=function(){const loggedInPermanent=localStorage.getItem("loggedIn")==="true";const loggedInSession=sessionStorage.getItem("loggedInSession")==="true";if(loggedInPermanent && !loggedInSession){alert("√ سيتم تسجيل الدخول تلقائيًا الآن...");sessionStorage.setItem("loggedInSession","true");location.reload();return;}if(loggedInPermanent||loggedInSession){const user=document.getElementById("username").value.trim();document.getElementById("login").style.display="none";document.getElementById("app").style.display="block";updateUserOnlineStatus(user,true);window.addEventListener("beforeunload",()=>updateUserOnlineStatus(user,false));}else{document.getElementById("login").style.display="block";}}
</script>

<script>
// === التعرف الصوتي + تحويل الكلمات إلى أرقام + الكلمات الذكية ===
let recognition;
let smartWords = {};

function wordsToNumbersInText(text) {
  const units = {
    "صفر":0,"واحد":1,"واحدة":1,"احد":1,"احدى":1,
    "اثنان":2,"اثنين":2,"اثنتان":2,"اثنتين":2,"ثنين":2,
    "ثلاثة":3,"ثلاث":3,
    "أربعة":4,"اربعة":4,"اربع":4,
    "خمسة":5,"خمس":5,
    "ستة":6,"ست":6,
    "سبعة":7,"سبع":7,
    "ثمانية":8,"ثمان":8,
    "تسعة":9,"تسع":9
  };

  const teens = {
    "أحد عشر":11,"احد عشر":11,"احدى عشر":11,
    "اثنا عشر":12,"اثني عشر":12,"ثنعش":12,
    "ثلاثة عشر":13,"ثلاث عشر":13,"تلتعش":13,
    "أربعة عشر":14,"اربعة عشر":14,"اربعطش":14,
    "خمسة عشر":15,"خمستعش":15,
    "ستة عشر":16,"ستعش":16,
    "سبعة عشر":17,"سبعتعش":17,
    "ثمانية عشر":18,"تمنتعش":18,
    "تسعة عشر":19,"تسعتعش":19
  };

  const tens = {
    "عشرة":10,"عشر":10,
    "عشرون":20,"عشرين":20,
    "ثلاثون":30,"ثلاثين":30,
    "أربعون":40,"اربعين":40,
    "خمسون":50,"خمسين":50,
    "ستون":60,"ستين":60,
    "سبعون":70,"سبعين":70,
    "ثمانون":80,"ثمانين":80,
    "تسعون":90,"تسعين":90
  };

  const hundreds = {
    "مائة":100,"مئة":100,"مية":100,
    "مئتان":200,"مئتين":200,"ميتين":200,
    "ثلاثمائة":300,"ثلاثمية":300,
    "أربعمائة":400,"اربعماية":400,
    "خمسمائة":500,"خمسماية":500,
    "ستمائة":600,"ستمية":600,
    "سبعمائة":700,"سبعمية":700,
    "ثمانمائة":800,"ثمانمية":800,
    "تسعمائة":900,"تسعمية":900
  };

  const multipliers = {
    "ألف":1000,"الف":1000,"آلاف":1000,
    "مليون":1000000,"ملايين":1000000,
    "مليار":1000000000,"مليارات":1000000000
  };

  const decimalMarkers = ["فاصلة","فارزة","نقطة"];

  const tokens = text.replace(/،/g," ").replace(/ و /g," ").trim().split(/\s+/);

  let resultWords = [];
  let numberBuffer = [];

  function parseSmall(buffer) {
    let total = 0;
    buffer.forEach(word=>{
      if(teens[word]!==undefined) total += teens[word];
      else if(units[word]!==undefined) total += units[word];
      else if(tens[word]!==undefined) total += tens[word];
      else if(hundreds[word]!==undefined) total += hundreds[word];
    });
    return total;
  }

  function parseNumber(buffer) {
    let total = 0, current = 0;
    buffer.forEach(word=>{
      if(multipliers[word]!==undefined){
        let mult = multipliers[word];
        if(current===0) current=1;
        total += current*mult;
        current = 0;
      } else {
        current += parseSmall([word]);
      }
    });
    return total + current;
  }

  for(let i=0;i<tokens.length;i++){
    let word = tokens[i];
    let twoWords = word+" "+(tokens[i+1]||"");

    if(teens[twoWords]!==undefined){
      numberBuffer.push(twoWords);
      i++;
      continue;
    }

    if(units[word]!==undefined || tens[word]!==undefined || hundreds[word]!==undefined || multipliers[word]!==undefined){
      numberBuffer.push(word);
    } else if(decimalMarkers.includes(word)){
      if(numberBuffer.length>0){
        const num = parseNumber(numberBuffer);
        resultWords.push(num.toString());
        numberBuffer = [];
      }
      resultWords.push(".");
    } else {
      if(numberBuffer.length>0){
        const num = parseNumber(numberBuffer);
        resultWords.push(num.toString());
        numberBuffer = [];
      }
      resultWords.push(word);
    }
  }

  if(numberBuffer.length>0){
    const num = parseNumber(numberBuffer);
    resultWords.push(num.toString());
  }

  let finalWords = [];
  for(let i=0;i<resultWords.length;i++){
    if(resultWords[i]==="." && i>0 && i<resultWords.length-1){
      let merged = resultWords[i-1]+"."+resultWords[i+1];
      finalWords.pop();
      finalWords.push(merged);
      i++;
    } else {
      finalWords.push(resultWords[i]);
    }
  }

  return finalWords.join(" ");
}

function convert(){
  const input=document.getElementById("inputText").value;
  const output=wordsToNumbersInText(input);
  document.getElementById("output").innerText=output;
}
    
function extractDateFromText(text){
  const regex=/(\d{4})[\/\\](\d{1,2})[\/\\](\d{1,2})/;
  const match=text.match(regex);
  if(match){
    let [_,year,month,day]=match.map(Number);
    if(year>=1000 && year<=2999 && month>=1 && month<=12 && day>=1 && day<=31){
      return `${year}/${String(month).padStart(2,"0")}/${String(day).padStart(2,"0")}`;
    }
  }
  if(/سنة|شهر|يوم/.test(text)){
    const parts=text.split(/\s+/).map(p=>parseInt(p)).filter(n=>!isNaN(n));
    if(parts.length>=3){
      const [year,month,day]=parts;
      if(year>=1000 && year<=2999 && month>=1 && month<=12 && day>=1 && day<=31){
        return `${year}/${String(month).padStart(2,"0")}/${String(day).padStart(2,"0")}`;
      }
    }
  }
  return null;
}

function startRecognition(){
  const SpeechRecognition=window.webkitSpeechRecognition;
  if(!SpeechRecognition){alert("❌ هذه الميزة تعمل فقط على متصفح Chrome.");return;}
  recognition=new SpeechRecognition();
  recognition.lang='ar-IQ';
  recognition.interimResults=false;
  recognition.onstart=function(){
    document.querySelector(".container").classList.add("recording");
    document.getElementById("recordingIndicator").style.display="block";
    document.getElementById("startBtn").style.display="none";
    document.getElementById("stopBtn").style.display="inline-block";
  }
  recognition.onresult=function(event){
    const transcript=event.results[0][0].transcript;
    const converted=wordsToNumbersInText(transcript);
    const dateFormat=extractDateFromText(converted);
    const outputText = dateFormat?dateFormat:converted;

    document.getElementById("outputText").innerText = outputText;
    addToHistory(outputText);
    navigator.clipboard.writeText(outputText).catch(()=>{});
  }
  recognition.onend=function(){
    document.querySelector(".container").classList.remove("recording");
    document.getElementById("recordingIndicator").style.display="none";
    document.getElementById("startBtn").style.display="inline-block";
    document.getElementById("stopBtn").style.display="none";
  }
  recognition.start();
}

function stopRecognition(){if(recognition){recognition.stop();}}

// === سجل التاريخ ===
const historyEl = document.getElementById("history");
const toggleBtn = document.getElementById("toggleHistoryBtn");
const copyAllBtn = document.getElementById("copyAllHistoryBtn");
let isHorizontal = false;

toggleBtn.addEventListener("click", ()=>{
  if(isHorizontal){
    historyEl.style.flexDirection = "column";
    historyEl.style.flexWrap = "nowrap";
  } else {
    historyEl.style.flexDirection = "row";
    historyEl.style.flexWrap = "wrap";
  }
  isHorizontal = !isHorizontal;
});

copyAllBtn.addEventListener("click", ()=>{
  const allText = Array.from(historyEl.children).map(d=>d.innerText).join("\n");
  navigator.clipboard.writeText(allText).then(()=>{
    const existingIcon = copyAllBtn.querySelector("span");
    if(existingIcon) existingIcon.remove();
    const icon = document.createElement("span");
    icon.innerText = "[√]";
    icon.style.marginLeft = "6px";
    copyAllBtn.appendChild(icon);
    setTimeout(()=>{icon.remove();},1000);
  });
});

function addToHistory(text){
  const lineDiv = document.createElement("div");
  lineDiv.style.cursor = "pointer";
  lineDiv.style.padding = "2px 6px";
  lineDiv.style.background = "#1a1a1a";
  lineDiv.style.borderRadius = "4px";
  lineDiv.style.margin = "2px 2px";
  lineDiv.style.textAlign = "center"; 
  lineDiv.style.width = "auto";       
  lineDiv.innerText = text;

  lineDiv.addEventListener("click", ()=>{
    navigator.clipboard.writeText(text).then(()=>{
      const copyIcon = document.createElement("span");
      copyIcon.innerText = "[√]";
      copyIcon.style.marginLeft = "6px";
      lineDiv.appendChild(copyIcon);
      setTimeout(()=>{copyIcon.remove();},1000);
    });
  });

  historyEl.appendChild(lineDiv);
  historyEl.scrollTop = historyEl.scrollHeight;
}

// === الكلمات الذكية ===
const smartBtn = document.getElementById("smartWordsBtn");
const smartMenu = document.getElementById("smartWordsMenu");
const smartList = document.getElementById("smartWordsList");
smartBtn.addEventListener("click", ()=>{
    smartMenu.style.display = smartMenu.style.display==="flex"?"none":"flex";
    smartMenu.style.flexDirection="column";
});

function addSmartWord(){
  const wrong = document.getElementById("wrongWord").value.trim();
  const right = document.getElementById("correctWord").value.trim();
  if(!wrong || !right) return alert("يرجى ملء الحقلين");
  smartWords[wrong] = right;
  renderSmartWords();
  document.getElementById("wrongWord").value = "";
  document.getElementById("correctWord").value = "";
}

function renderSmartWords(){
  smartList.innerHTML = "";
  Object.keys(smartWords).forEach(k => {
    const div = document.createElement("div");
    div.className = "smartWordItem";
    const span = document.createElement("span");
    span.innerText = `${k} ⟸ ${smartWords[k]}`;
    const btn = document.createElement("button");
    btn.innerText = "X";
    btn.onclick = () => { delete smartWords[k]; renderSmartWords(); }
    div.appendChild(span);
    div.appendChild(btn);
    smartList.appendChild(div);
  });
}

function toggleSmartMenu(){smartMenu.style.display="none";}

// === زر القائمة العلوية ===
const menuBtn = document.getElementById('menuBtn');
const menuDropdown = document.getElementById('menuDropdown');

menuBtn.addEventListener('click', ()=>{
    menuDropdown.style.display = menuDropdown.style.display === 'flex' ? 'none' : 'flex';
    menuDropdown.style.flexDirection = 'column';
});

// إغلاق القائمة عند الضغط خارجها
window.addEventListener('click', (e)=>{
    if(!menuBtn.contains(e.target) && !menuDropdown.contains(e.target)){
        menuDropdown.style.display = 'none';
    }
});

// === زر الاستعلام الدائري أسفل الفوتر ===
// ملاحظة: في كودك الأصلي لم يكن هناك عنصر مع id="helpBtn" لذا نتحقق من وجوده قبل إضافة مستمعي الأحداث حتى لا يسبب خطأ.
const helpBtn = document.getElementById('helpBtn');
const helpModal = document.getElementById('helpModal');
if(helpBtn){
  helpBtn.addEventListener('mouseenter', ()=>{
      helpBtn.style.backgroundColor = 'rgba(255, 204, 0, 1)';
      helpBtn.style.boxShadow = '0 0 20px rgba(255,255,0,0.8)';
  });

  helpBtn.addEventListener('mouseleave', ()=>{
      helpBtn.style.backgroundColor = 'rgba(255, 204, 0, 0.4)';
      helpBtn.style.boxShadow = '0 0 10px rgba(255,255,0,0.3)';
  });

  helpBtn.addEventListener('click', ()=>{
      helpModal.style.display = 'block';
  });
}

window.addEventListener('click', (e)=>{
    if(e.target === helpModal){
        helpModal.style.display = 'none';
    }
});

// === تصدير الكلمات الذكية كملف JSON ===
function exportSmartWords() {
  try {
    const dataStr = JSON.stringify(smartWords, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    // اسم الملف قابل للتغيير لو أردت
    a.download = "recovery_txt.json";
    a.click();

    URL.revokeObjectURL(url);
  } catch (err) {
    alert("فشل التصدير");
  }
}

// === استيراد الكلمات الذكية من ملف JSON ===
function importSmartWords(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const imported = JSON.parse(e.target.result);
      if (typeof imported === "object" && imported !== null) {
        // دمج المحتوى المستورد مع smartWords الحالي
        smartWords = { ...smartWords, ...imported };
        renderSmartWords();
        alert("√ تم استيراد الكلمات بنجاح");
      } else {
        alert("X تنسيق الملف غير صحيح");
      }
    } catch (err) {
      alert("X ملف غير صالح");
    }
    // إعادة تعيين قيمة input حتى تسمح بتحميل نفس الملف مرة ثانية إذا رغب المستخدم
    event.target.value = "";
  };
  reader.readAsText(file);
}
</script>

</body>
</html>
