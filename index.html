<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تحويل الصوت إلى نص</title>
  <style>
    /* خلفية الصفحة */
    body {
      margin: 0;
      padding: 0;
      background-color: #000; /* أسود */
      color: #fff;
      font-family: Tahoma, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }

    /* صندوق المحتوى */
    .container {
      background-color: #111;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      text-align: center;
      width: 90%;
      max-width: 600px;
    }

    h1 {
      margin-bottom: 20px;
      font-size: 24px;
    }

    button {
      padding: 12px 24px;
      font-size: 18px;
      margin: 10px 5px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    #startBtn {
      background-color: #4CAF50;
      color: white;
    }

    #stopBtn {
      background-color: #f44336;
      color: white;
      display: none;
    }

    button:hover {
      opacity: 0.85;
    }

    #recordingIndicator {
      display: none;
      color: #ff5252;
      font-weight: bold;
      margin-top: 10px;
    }

    #recordingDot {
      display: inline-block;
      width: 12px;
      height: 12px;
      background-color: red;
      border-radius: 50%;
      margin-left: 8px;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    #output {
      background: #222;
      border: 1px solid #444;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 18px;
      min-height: 80px;
      white-space: pre-wrap;
      color: #ddd;
    }

    textarea {
      width: 96%;
      margin-top: 15px;
      padding: 12px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #555;
      background-color: #1a1a1a;
      color: #fff;
      resize: vertical;
    }

    /* ستايل الفوتر */
    footer {
      margin-top: 15px;
      font-size: 14px;
      color: #888;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1> [ تحويل الصوت إلى نص كروم فقط ]</h1>
    <button id="startBtn" onclick="startRecognition()">[▶︎] بدء التسجيل</button>
    <button id="stopBtn" onclick="stopRecognition()">[X] إيقاف التسجيل</button>

    <div id="recordingIndicator">
      <span id="recordingDot"></span> ▶︎ جاري التسجيل...
    </div>

    <div id="output"></div>

    <textarea id="textField" rows="4" placeholder="الصق النص هنا إذا أردت (Ctrl + V)"></textarea>

    <footer>
      &copy; ✈DRAGON&CHEAT 2025
    </footer>
  </div>

  <script>
    let recognition;
    let finalTranscript = "";

    function wordsToNumbersInText(text) {
      const units = {
        "صفر": 0, "واحد": 1, "واحدة": 1, "احد": 1, "احدى": 1,
        "اثنان": 2, "اثنين": 2, "اثنتان": 2, "اثنتين": 2, "ثنين": 2,
        "ثلاثة": 3, "ثلاث": 3,
        "أربعة": 4, "اربعة": 4, "اربع": 4,
        "خمسة": 5, "خمس": 5,
        "ستة": 6, "ست": 6,
        "سبعة": 7, "سبع": 7,
        "ثمانية": 8, "ثمان": 8,
        "تسعة": 9, "تسع": 9
      };

      const teens = {
        "عشرة": 10, "عشر": 10,
        "أحد عشر": 11, "احد عشر": 11, "احدى عشر": 11,
        "اثنا عشر": 12, "اثني عشر": 12,
        "ثلاثة عشر": 13, "أربعة عشر": 14, "خمسة عشر": 15,
        "ستة عشر": 16, "سبعة عشر": 17, "ثمانية عشر": 18, "تسعة عشر": 19
      };

      const tens = {
        "عشرون": 20, "عشرين": 20,
        "ثلاثون": 30, "ثلاثين": 30,
        "أربعون": 40, "اربعين": 40,
        "خمسون": 50, "خمسين": 50,
        "ستون": 60, "ستين": 60,
        "سبعون": 70, "سبعين": 70,
        "ثمانون": 80, "ثمانين": 80,
        "تسعون": 90, "تسعين": 90
      };

      const hundreds = {
        "مائة": 100, "مئة": 100, "مية": 100,
        "مئتين": 200, "ميتين": 200,
        "ثلاثمائة": 300, "ثلاثمية": 300,
        "أربعمائة": 400, "اربعماية": 400,
        "خمسمائة": 500, "خمسماية": 500,
        "ستمائة": 600, "ستمية": 600,
        "سبعمائة": 700, "سبعمية": 700,
        "ثمانمائة": 800, "ثمانمية": 800,
        "تسعمائة": 900, "تسعمية": 900
      };

      const multipliers = {
        "ألف": 1000, "الف": 1000, "ألفين": 2000, "الفين": 2000,
        "آلاف": 1000,
        "مليون": 1000000, "ملايين": 1000000
      };

      const allWords = Object.assign({}, units, teens, tens, hundreds, multipliers);

      const tokens = text.replace(/،/g, " ").replace(/ و /g, " ").trim().split(/\s+/);
      let resultWords = [];
      let numberBuffer = [];

      function processBuffer(buffer) {
        let total = 0;
        let current = 0;

        buffer.forEach((word, i) => {
          if (teens[word] !== undefined) {
            current += teens[word];
          } else if (units[word] !== undefined) {
            current += units[word];
          } else if (tens[word] !== undefined) {
            current += tens[word];
          } else if (hundreds[word] !== undefined) {
            current += hundreds[word];
          } else if (multipliers[word] !== undefined) {
            if (current === 0) current = 1;
            current *= multipliers[word];
            total += current;
            current = 0;
          }
        });

        total += current;
        return total;
      }

      for (let i = 0; i < tokens.length; i++) {
        const word = tokens[i];
        const fullTwoWords = tokens[i] + " " + (tokens[i + 1] || "");

        if (teens[fullTwoWords]) {
          numberBuffer.push(fullTwoWords);
          i++; // تخطي الكلمة التالية
          continue;
        }

        if (allWords[word]) {
          numberBuffer.push(word);
        } else {
          if (numberBuffer.length > 0) {
            const num = processBuffer(numberBuffer);
            resultWords.push(num.toString());
            numberBuffer = [];
          }
          resultWords.push(word);
        }
      }

      if (numberBuffer.length > 0) {
        const num = processBuffer(numberBuffer);
        resultWords.push(num.toString());
      }

      return resultWords.join(" ");
    }

    function startRecognition() {
      const SpeechRecognition = window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("❌ هذه الميزة تعمل فقط على متصفح Chrome.");
        return;
      }

      recognition = new SpeechRecognition();
      recognition.lang = 'ar-IQ'; // دعم لهجة العراق
      recognition.interimResults = false;

      recognition.onstart = function () {
        document.getElementById("recordingIndicator").style.display = "block";
        document.getElementById("startBtn").style.display = "none";
        document.getElementById("stopBtn").style.display = "inline-block";
      };

      recognition.onresult = function (event) {
        const transcript = event.results[0][0].transcript;
        const converted = wordsToNumbersInText(transcript);
        document.getElementById("output").innerText = converted;

        // نسخ إلى الحافظة تلقائيًا
        navigator.clipboard.writeText(converted);
      };

      recognition.onerror = function (event) {
        alert("حدث خطأ: " + event.error);
      };

      recognition.onend = function () {
        document.getElementById("recordingIndicator").style.display = "none";
        document.getElementById("startBtn").style.display = "inline-block";
        document.getElementById("stopBtn").style.display = "none";
      };

      recognition.start();
    }

    function stopRecognition() {
      if (recognition) {
        recognition.stop();
      }
    }
  </script>
</body>
</html>
