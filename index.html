<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Convert audio</title>
<style>
/* === Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ÙƒÙ…Ø§ ÙÙŠ ÙƒÙˆØ¯Ùƒ === */
body{margin:0;padding:0;background-color:#000;color:#fff;font-family:Tahoma,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column}.login-container{background-color:#111;padding:30px;border-radius:12px;box-shadow:0 0 20px rgba(255,255,255,0.15);text-align:center;width:90%;max-width:400px;display:none}.login-container h2{margin-bottom:20px;font-size:22px;color:#ffcc00}.login-container input{width:90%;padding:12px;margin:10px 0;border-radius:8px;border:1px solid #444;background-color:#1a1a1a;color:#fff;font-size:16px;text-align:center;direction:ltr;unicode-bidi:embed}.login-container label{font-size:14px;display:inline-block;align-items:center;justify-content:center;gap:1px;margin-top:10px;cursor:pointer;width:-55â„…;text-align:center;position:relative;top:11px}.login-container button{padding:12px 24px;font-size:18px;margin-top:15px;border:none;border-radius:8px;background-color:#4CAF50;color:white;cursor:pointer;transition:0.3s}.login-container button:hover{opacity:0.85}.container{background-color:#111;padding:30px;border-radius:12px;box-shadow:0 0 20px rgba(255,255,255,0.1);text-align:center;width:90%;max-width:600px;transition:all 0.3s ease;display:none;position:relative}h1{margin-bottom:20px;font-size:24px;transition:font-size 0.3s ease}button{padding:12px 24px;font-size:18px;margin:10px 5px;border:none;border-radius:8px;cursor:pointer;transition:0.3s,font-size 0.3s ease,padding 0.3s ease}#startBtn{background-color:#4CAF50;color:white}#stopBtn{background-color:#f44336;color:white;display:none}button:hover{opacity:0.85}#recordingIndicator{display:none;color:#ff5252;font-weight:bold;margin-top:10px}#recordingDot{display:inline-block;width:12px;height:12px;background-color:red;border-radius:50%;margin-left:8px;animation:blink 1s infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}#output{background:#222;border:1px solid #444;padding:15px;border-radius:8px;margin-top:20px;font-size:18px;min-height:80px;white-space:pre-wrap;color:#ddd;transition:font-size 0.3s ease,padding 0.3s ease;direction:ltr;unicode-bidi:embed;text-align:center}textarea{width:96%;margin-top:15px;padding:12px;font-size:16px;border-radius:6px;border:1px solid #555;background-color:#1a1a1a;color:#fff;resize:vertical;transition:font-size 0.3s ease,padding 0.3s ease}#userCountContainer{position:relative;top:-22px;left:15px;right:15px;display:flex;align-items:center;font-size:12px;opacity:0.8;justify-content:space-between}#userCount{color:#0f0}#logoutBtn{font-size:12px;padding:4px 8px;border-radius:6px;border:none;background-color:#f44336;color:white;cursor:pointer;opacity:0.9}footer{margin-top:15px;font-size:14px;color:#b17215;text-align:center}@keyframes rgbGlow{0%{box-shadow:0 0 40px 15px rgba(255,0,0,0.25)}20%{box-shadow:0 0 40px 15px rgba(255,165,0,0.25)}40%{box-shadow:0 0 40px 15px rgba(0,255,0,0.25)}60%{box-shadow:0 0 40px 15px rgba(0,255,255,0.25)}80%{box-shadow:0 0 40px 15px rgba(0,0,255,0.25)}100%{box-shadow:0 0 40px 15px rgba(255,0,255,0.25)}}.container.recording{animation:rgbGlow 10s infinite linear}@media (max-width:500px){.container{padding:20px}.container h1{font-size:20px}button{font-size:16px;padding:10px 18px}#output{font-size:16px;padding:12px}textarea{font-size:14px;padding:10px}}@media (max-width:350px){.container{padding:15px}.container h1{font-size:18px}button{font-size:14px;padding:8px 16px}#output{font-size:14px;padding:10px}textarea{font-size:13px;padding:8px}}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDa1_gisk5GuTvRzACp0lA1TGe3-b2Sz8A",
  authDomain: "dragon-tv-3e8c1.firebaseapp.com",
  databaseURL: "https://dragon-tv-3e8c1-default-rtdb.firebaseio.com",
  projectId: "dragon-tv-3e8c1",
  storageBucket: "dragon-tv-3e8c1.firebasestorage.app",
  messagingSenderId: "909817368695",
  appId: "1:909817368695:web:b5e9ffccafefcbc41a7672"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>
</head>
<body>
<div class="login-container" id="login">
<h2>âŸ± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âŸ±</h2>
<input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<label><input type="checkbox" id="rememberMe">Ø°ÙƒØ±Ù†ÙŠ</label>
<button onclick="checkLogin()">Ø¯Ø®ÙˆÙ„</button>
<p id="error" style="color:red; display:none;">!! Ø®Ø·Ø£ ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
</div>

<div class="container" id="app">
<div id="userCountContainer">
  <div id="userCount"># Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: 0</div>
  <button id="logoutBtn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<h1> [ Convert Audio To Text In Iraqi ]</h1><br>
<button id="startBtn" onclick="startRecognition()">[â–¶ï¸] Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
<button id="stopBtn" onclick="stopRecognition()">[X] Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>

<div id="recordingIndicator">
  <span id="recordingDot"></span> â–¶ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...
</div>

<div id="output"></div>

<!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„ØªØ¨Ø¯ÙŠÙ„ -->
<div id="historyContainer" style="width:96%; min-height:150px; max-height:200px; 
     border:1px solid #555; border-radius:6px; background:#1a1a1a; 
     position:relative; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:4px; flex-wrap:wrap;">

  <button id="toggleHistoryBtn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶" 
          style="position:absolute;top:5px;left:5px;padding:4px 8px;font-size:12px; z-index:10;">â‡„</button>

  <button id="copyAllHistoryBtn" title="Ù†Ø³Ø® Ø§Ù„ÙƒÙ„" 
          style="position:absolute;top:5px;right:5px;padding:4px 8px;font-size:12px; z-index:10;">ğŸ“‹</button>

  <div id="history" style="width:100%; display:flex; flex-direction:column; gap:4px; flex-wrap:wrap;"></div>
</div>

<footer>
  &copy; DRAGON&CHEAT 2025 @
</footer>
</div>

<script>
// === Ø¯ÙˆØ§Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆFirebase ÙƒÙ…Ø§ Ù‡ÙŠ ===
function base64EncodeUnicode(str){return btoa(unescape(encodeURIComponent(str)));}
const deviceId = crypto.randomUUID();
function updateUserOnlineStatus(username,online){const ref=db.ref('onlineUsers/'+username+'/'+deviceId);if(online){ref.set(true);ref.onDisconnect().remove();}else{ref.remove();db.ref('onlineUsers/'+username).once('value',snap=>{if(!snap.exists()){db.ref('onlineUsers/'+username).remove();}});}}
db.ref('onlineUsers').on('value',snapshot=>{document.getElementById("userCount").textContent="# Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: "+snapshot.numChildren();});
function checkLogin(){const user=document.getElementById("username").value.trim();const pass=document.getElementById("password").value.trim();const remember=document.getElementById("rememberMe").checked;const encodedUser="2LnZhNin2KE=";const encodedPass="MjI0NA==";if(base64EncodeUnicode(user)===encodedUser && base64EncodeUnicode(pass)===encodedPass){if(remember)localStorage.setItem("loggedIn","true");else sessionStorage.setItem("loggedInSession","true");document.getElementById("login").style.display="none";document.getElementById("app").style.display="block";updateUserOnlineStatus(user,true);window.addEventListener("beforeunload",()=>updateUserOnlineStatus(user,false));}else{document.getElementById("error").style.display="block";}}
function logout(){const user=document.getElementById("username").value.trim();updateUserOnlineStatus(user,false);localStorage.removeItem("loggedIn");sessionStorage.removeItem("loggedInSession");document.getElementById("app").style.display="none";document.getElementById("login").style.display="block";}
window.onload=function(){const loggedInPermanent=localStorage.getItem("loggedIn")==="true";const loggedInSession=sessionStorage.getItem("loggedInSession")==="true";if(loggedInPermanent && !loggedInSession){alert("âˆš Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø§Ù„Ø¢Ù†...");sessionStorage.setItem("loggedInSession","true");location.reload();return;}if(loggedInPermanent||loggedInSession){const user=document.getElementById("username").value.trim();document.getElementById("login").style.display="none";document.getElementById("app").style.display="block";updateUserOnlineStatus(user,true);window.addEventListener("beforeunload",()=>updateUserOnlineStatus(user,false));}else{document.getElementById("login").style.display="block";}}
</script>

<script>
// === Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ + ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¥Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… Ù…Ø¹ Ø¹ÙƒØ³ ÙƒÙ„ Ø±Ù‚Ù… ===
let recognition;

function wordsToNumbersInText(text){
  const units={"ØµÙØ±":0,"ÙˆØ§Ø­Ø¯":1,"ÙˆØ§Ø­Ø¯Ø©":1,"Ø§Ø­Ø¯":1,"Ø§Ø­Ø¯Ù‰":1,"Ø§Ø«Ù†Ø§Ù†":2,"Ø§Ø«Ù†ÙŠÙ†":2,"Ø§Ø«Ù†ØªØ§Ù†":2,"Ø§Ø«Ù†ØªÙŠÙ†":2,"Ø«Ù†ÙŠÙ†":2,"Ø«Ù„Ø§Ø«Ø©":3,"Ø«Ù„Ø§Ø«":3,"Ø£Ø±Ø¨Ø¹Ø©":4,"Ø§Ø±Ø¨Ø¹Ø©":4,"Ø§Ø±Ø¨Ø¹":4,"Ø®Ù…Ø³Ø©":5,"Ø®Ù…Ø³":5,"Ø³ØªØ©":6,"Ø³Øª":6,"Ø³Ø¨Ø¹Ø©":7,"Ø³Ø¨Ø¹":7,"Ø«Ù…Ø§Ù†ÙŠØ©":8,"Ø«Ù…Ø§Ù†":8,"ØªØ³Ø¹Ø©":9,"ØªØ³Ø¹":9};
  const teens={"Ø¹Ø´Ø±Ø©":10,"Ø¹Ø´Ø±":10,"Ø£Ø­Ø¯ Ø¹Ø´Ø±":11,"Ø§Ø­Ø¯ Ø¹Ø´Ø±":11,"Ø§Ø­Ø¯Ù‰ Ø¹Ø´Ø±":11,"Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±":12,"Ø§Ø«Ù†ÙŠ Ø¹Ø´Ø±":12,"Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±":13,"Ø«Ù„Ø§Ø« Ø¹Ø´Ø±":13,"Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±":14,"Ø§Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±":14,"Ø®Ù…Ø³Ø© Ø¹Ø´Ø±":15,"Ø³ØªØ© Ø¹Ø´Ø±":16,"Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±":17,"Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±":18,"ØªØ³Ø¹Ø© Ø¹Ø´Ø±":19};
  const tens={"Ø¹Ø´Ø±ÙˆÙ†":20,"Ø¹Ø´Ø±ÙŠÙ†":20,"Ø«Ù„Ø§Ø«ÙˆÙ†":30,"Ø«Ù„Ø§Ø«ÙŠÙ†":30,"Ø£Ø±Ø¨Ø¹ÙˆÙ†":40,"Ø§Ø±Ø¨Ø¹ÙŠÙ†":40,"Ø®Ù…Ø³ÙˆÙ†":50,"Ø®Ù…Ø³ÙŠÙ†":50,"Ø³ØªÙˆÙ†":60,"Ø³ØªÙŠÙ†":60,"Ø³Ø¨Ø¹ÙˆÙ†":70,"Ø³Ø¨Ø¹ÙŠÙ†":70,"Ø«Ù…Ø§Ù†ÙˆÙ†":80,"Ø«Ù…Ø§Ù†ÙŠÙ†":80,"ØªØ³Ø¹ÙˆÙ†":90,"ØªØ³Ø¹ÙŠÙ†":90};
  const hundreds={"Ù…Ø§Ø¦Ø©":100,"Ù…Ø¦Ø©":100,"Ù…ÙŠØ©":100,"Ù…Ø¦ØªÙŠÙ†":200,"Ù…ÙŠØªÙŠÙ†":200,"Ø«Ù„Ø§Ø«Ù…Ø§Ø¦Ø©":300,"Ø«Ù„Ø§Ø«Ù…ÙŠØ©":300,"Ø£Ø±Ø¨Ø¹Ù…Ø§Ø¦Ø©":400,"Ø§Ø±Ø¨Ø¹Ù…Ø§ÙŠØ©":400,"Ø®Ù…Ø³Ù…Ø§Ø¦Ø©":500,"Ø®Ù…Ø³Ù…Ø§ÙŠØ©":500,"Ø³ØªÙ…Ø§Ø¦Ø©":600,"Ø³ØªÙ…ÙŠØ©":600,"Ø³Ø¨Ø¹Ù…Ø§Ø¦Ø©":700,"Ø³Ø¨Ø¹Ù…ÙŠØ©":700,"Ø«Ù…Ø§Ù†Ù…Ø§Ø¦Ø©":800,"Ø«Ù…Ø§Ù†Ù…ÙŠØ©":800,"ØªØ³Ø¹Ù…Ø§Ø¦Ø©":900,"ØªØ³Ø¹Ù…ÙŠØ©":900};
  const multipliers={"Ø£Ù„Ù":1000,"Ø§Ù„Ù":1000,"Ø£Ù„ÙÙŠÙ†":2000,"Ø§Ù„ÙÙŠÙ†":2000,"Ø¢Ù„Ø§Ù":1000,"Ù…Ù„ÙŠÙˆÙ†":1000000,"Ù…Ù„Ø§ÙŠÙŠÙ†":1000000};
  const allWords=Object.assign({},units,teens,tens,hundreds,multipliers);

  const tokens=text.replace(/ØŒ/g," ").replace(/ Ùˆ /g," ").trim().split(/\s+/);
  let resultWords=[];
  let numberBuffer=[];

  function processBuffer(buffer){
    let total=0;
    let current=0;
    buffer.forEach(word=>{
      if(teens[word]!==undefined) current+=teens[word];
      else if(units[word]!==undefined) current+=units[word];
      else if(tens[word]!==undefined) current+=tens[word];
      else if(hundreds[word]!==undefined) current+=hundreds[word];
      else if(multipliers[word]!==undefined){
        if(multipliers[word]>=1000){
          current=(current===0?1:current)*multipliers[word];
          total+=current;
          current=0;
        } else {
          current*=multipliers[word];
        }
      }
    });
    total+=current;
    return total.toString().split("").reverse().join("");
  }

  for(let i=0;i<tokens.length;i++){
    const word=tokens[i];
    const twoWords=word+" "+(tokens[i+1]||"");

    if(teens[twoWords]){
      numberBuffer.push(twoWords);
      i++;
      continue;
    }

    if(allWords[word]){
      numberBuffer.push(word);
    } else {
      if(numberBuffer.length>0){
        const num=processBuffer(numberBuffer);
        resultWords.push(num);
        numberBuffer=[];
      }
      resultWords.push(word);
    }
  }

  if(numberBuffer.length>0){
    const num=processBuffer(numberBuffer);
    resultWords.push(num);
  }

  return resultWords.join(" ");
}

function extractDateFromText(text){
  const regex=/(\d{4})[\/\\](\d{1,2})[\/\\](\d{1,2})/;
  const match=text.match(regex);
  if(match){
    let [_,year,month,day]=match.map(Number);
    if(year>=1000 && year<=2999 && month>=1 && month<=12 && day>=1 && day<=31){
      return `${year}/${String(month).padStart(2,"0")}/${String(day).padStart(2,"0")}`;
    }
  }

  if(/Ø³Ù†Ø©|Ø´Ù‡Ø±|ÙŠÙˆÙ…/.test(text)){
    const parts=text.split(/\s+/).map(p=>parseInt(p)).filter(n=>!isNaN(n));
    if(parts.length>=3){
      const [year,month,day]=parts;
      if(year>=1000 && year<=2999 && month>=1 && month<=12 && day>=1 && day<=31){
        return `${year}/${String(month).padStart(2,"0")}/${String(day).padStart(2,"0")}`;
      }
    }
  }

  return null;
}

function startRecognition(){
  const SpeechRecognition=window.webkitSpeechRecognition;
  if(!SpeechRecognition){alert("âŒ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØªØ¹Ù…Ù„ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ù…ØªØµÙØ­ Chrome.");return;}
  recognition=new SpeechRecognition();
  recognition.lang='ar-IQ';
  recognition.interimResults=false;
  recognition.onstart=function(){
    document.querySelector(".container").classList.add("recording");
    document.getElementById("recordingIndicator").style.display="block";
    document.getElementById("startBtn").style.display="none";
    document.getElementById("stopBtn").style.display="inline-block";
  }
  recognition.onresult=function(event){
    const transcript=event.results[0][0].transcript;
    const converted=wordsToNumbersInText(transcript);
    const dateFormat=extractDateFromText(converted);
    const outputText = dateFormat?dateFormat:converted;

    document.getElementById("output").innerText = outputText;
    addToHistory(outputText);
    navigator.clipboard.writeText(outputText).catch(()=>{});
  }
  recognition.onend=function(){
    document.querySelector(".container").classList.remove("recording");
    document.getElementById("recordingIndicator").style.display="none";
    document.getElementById("startBtn").style.display="inline-block";
    document.getElementById("stopBtn").style.display="none";
  }
  recognition.start();
}

function stopRecognition(){if(recognition){recognition.stop();}}

// === Ø¥Ø¶Ø§ÙØ§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¯ÙŠØ«Ø© ===
const historyEl = document.getElementById("history");
const toggleBtn = document.getElementById("toggleHistoryBtn");
const copyAllBtn = document.getElementById("copyAllHistoryBtn");
let isHorizontal = false;

toggleBtn.addEventListener("click", ()=>{
  if(isHorizontal){
    historyEl.style.flexDirection = "column";
    historyEl.style.flexWrap = "nowrap";
  } else {
    historyEl.style.flexDirection = "row";
    historyEl.style.flexWrap = "wrap";
  }
  isHorizontal = !isHorizontal;
});

copyAllBtn.addEventListener("click", ()=>{
  const allText = Array.from(historyEl.children).map(d=>d.innerText).join("\n");
  navigator.clipboard.writeText(allText).then(()=>{
    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§
    const existingIcon = copyAllBtn.querySelector("span");
    if(existingIcon) existingIcon.remove();

    // Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© âœ… Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø²Ø± Ù†ÙØ³Ù‡
    const icon = document.createElement("span");
    icon.innerText = " âœ…";
    icon.style.marginLeft = "6px";
    copyAllBtn.appendChild(icon);

    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
    setTimeout(()=>{icon.remove();},1000);
  });
});

function addToHistory(text){
  const lineDiv = document.createElement("div");
  lineDiv.style.cursor = "pointer";
  lineDiv.style.padding = "2px 6px";
  lineDiv.style.background = "#1a1a1a";
  lineDiv.style.borderRadius = "4px";
  lineDiv.style.margin = "2px 2px";
  lineDiv.style.display = "inline-flex";
  lineDiv.style.alignItems = "center";
  lineDiv.innerText = text;

  lineDiv.addEventListener("click", ()=>{
    navigator.clipboard.writeText(text).then(()=>{
      const copyIcon = document.createElement("span");
      copyIcon.innerText = " âœ…";
      copyIcon.style.marginLeft = "6px";
      lineDiv.appendChild(copyIcon);
      setTimeout(()=>{copyIcon.remove();},1000);
    });
  });

  historyEl.appendChild(lineDiv);
  historyEl.scrollTop = historyEl.scrollHeight;
}
</script>
</body>
</html>
