<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Convert audio</title>
  <style>
    /* == Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ØªØ¨Ø¹Ùƒ Ù†ÙØ³Ù‡Ø§ Ø¨Ø§Ù„Ø¶Ø¨Ø·ØŒ Ù…Ø§ ØºÙŠØ±Øª Ø´ÙŠØ¡ == */
    body {
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #fff;
      font-family: Tahoma, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù€ CSS ÙƒÙ…Ø§ Ù‡Ùˆ ... */
  </style>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDa1_gisk5GuTvRzACp0lA1TGe3-b2Sz8A",
      authDomain: "dragon-tv-3e8c1.firebaseapp.com",
      databaseURL: "https://dragon-tv-3e8c1-default-rtdb.firebaseio.com",
      projectId: "dragon-tv-3e8c1",
      storageBucket: "dragon-tv-3e8c1.firebasestorage.app",
      messagingSenderId: "909817368695",
      appId: "1:909817368695:web:b5e9ffccafefcbc41a7672"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
</head>
<body>
  <!-- Ù†ÙØ³ HTML ØªØ¨Ø¹Ùƒ Ø¨Ø§Ù„Ø¶Ø¨Ø· -->
  <div class="login-container" id="login">
    ...
  </div>

  <div class="container" id="app">
    ...
  </div>

  <script>
    /* Ù†ÙØ³ Ø§Ù„Ø¯ÙˆØ§Ù„ ØªØ¨Ø¹Ùƒ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØºÙŠÙŠØ± (base64EncodeUnicode, updateUserOnlineStatus, checkLogin, logout ...) */
  </script>

  <!-- Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ -->
  <script>
    let recognition;

    function wordsToNumbersInText(text) {
      /* Ù†ÙØ³ Ø¯Ø§Ù„ØªÙƒ Ø§Ù„Ø£ØµÙ„ÙŠØ© ØªØ¨Ø¹ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù„Ø£Ø±Ù‚Ø§Ù…ØŒ Ù…Ø§ ØºÙŠØ±Øª ÙÙŠÙ‡Ø§ */
      const units = {"ØµÙØ±":0,"ÙˆØ§Ø­Ø¯":1,"ÙˆØ§Ø­Ø¯Ø©":1,"Ø§Ø­Ø¯":1,"Ø§Ø­Ø¯Ù‰":1,"Ø§Ø«Ù†Ø§Ù†":2,"Ø§Ø«Ù†ÙŠÙ†":2,"Ø§Ø«Ù†ØªØ§Ù†":2,"Ø§Ø«Ù†ØªÙŠÙ†":2,"Ø«Ù†ÙŠÙ†":2,"Ø«Ù„Ø§Ø«Ø©":3,"Ø«Ù„Ø§Ø«":3,"Ø£Ø±Ø¨Ø¹Ø©":4,"Ø§Ø±Ø¨Ø¹Ø©":4,"Ø§Ø±Ø¨Ø¹":4,"Ø®Ù…Ø³Ø©":5,"Ø®Ù…Ø³":5,"Ø³ØªØ©":6,"Ø³Øª":6,"Ø³Ø¨Ø¹Ø©":7,"Ø³Ø¨Ø¹":7,"Ø«Ù…Ø§Ù†ÙŠØ©":8,"Ø«Ù…Ø§Ù†":8,"ØªØ³Ø¹Ø©":9,"ØªØ³Ø¹":9};
      const teens = {"Ø¹Ø´Ø±Ø©":10,"Ø¹Ø´Ø±":10,"Ø£Ø­Ø¯ Ø¹Ø´Ø±":11,"Ø§Ø­Ø¯ Ø¹Ø´Ø±":11,"Ø§Ø­Ø¯Ù‰ Ø¹Ø´Ø±":11,"Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±":12,"Ø§Ø«Ù†ÙŠ Ø¹Ø´Ø±":12,"Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±":13,"Ø«Ù„Ø§Ø« Ø¹Ø´Ø±":13,"Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±":14,"Ø§Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±":14,"Ø®Ù…Ø³Ø© Ø¹Ø´Ø±":15,"Ø³ØªØ© Ø¹Ø´Ø±":16,"Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±":17,"Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±":18,"ØªØ³Ø¹Ø© Ø¹Ø´Ø±":19};
      const tens = {"Ø¹Ø´Ø±ÙˆÙ†":20,"Ø¹Ø´Ø±ÙŠÙ†":20,"Ø«Ù„Ø§Ø«ÙˆÙ†":30,"Ø«Ù„Ø§Ø«ÙŠÙ†":30,"Ø£Ø±Ø¨Ø¹ÙˆÙ†":40,"Ø§Ø±Ø¨Ø¹ÙŠÙ†":40,"Ø®Ù…Ø³ÙˆÙ†":50,"Ø®Ù…Ø³ÙŠÙ†":50,"Ø³ØªÙˆÙ†":60,"Ø³ØªÙŠÙ†":60,"Ø³Ø¨Ø¹ÙˆÙ†":70,"Ø³Ø¨Ø¹ÙŠÙ†":70,"Ø«Ù…Ø§Ù†ÙˆÙ†":80,"Ø«Ù…Ø§Ù†ÙŠÙ†":80,"ØªØ³Ø¹ÙˆÙ†":90,"ØªØ³Ø¹ÙŠÙ†":90};
      const hundreds = {"Ù…Ø§Ø¦Ø©":100,"Ù…Ø¦Ø©":100,"Ù…ÙŠØ©":100,"Ù…Ø¦ØªÙŠÙ†":200,"Ù…ÙŠØªÙŠÙ†":200,"Ø«Ù„Ø§Ø«Ù…Ø§Ø¦Ø©":300,"Ø«Ù„Ø§Ø«Ù…ÙŠØ©":300,"Ø£Ø±Ø¨Ø¹Ù…Ø§Ø¦Ø©":400,"Ø§Ø±Ø¨Ø¹Ù…Ø§ÙŠØ©":400,"Ø®Ù…Ø³Ù…Ø§Ø¦Ø©":500,"Ø®Ù…Ø³Ù…Ø§ÙŠØ©":500,"Ø³ØªÙ…Ø§Ø¦Ø©":600,"Ø³ØªÙ…ÙŠØ©":600,"Ø³Ø¨Ø¹Ù…Ø§Ø¦Ø©":700,"Ø³Ø¨Ø¹Ù…ÙŠØ©":700,"Ø«Ù…Ø§Ù†Ù…Ø§Ø¦Ø©":800,"Ø«Ù…Ø§Ù†Ù…ÙŠØ©":800,"ØªØ³Ø¹Ù…Ø§Ø¦Ø©":900,"ØªØ³Ø¹Ù…ÙŠØ©":900};
      const multipliers = {"Ø£Ù„Ù":1000,"Ø§Ù„Ù":1000,"Ø£Ù„ÙÙŠÙ†":2000,"Ø§Ù„ÙÙŠÙ†":2000,"Ø¢Ù„Ø§Ù":1000,"Ù…Ù„ÙŠÙˆÙ†":1000000,"Ù…Ù„Ø§ÙŠÙŠÙ†":1000000};

      const allWords = Object.assign({}, units, teens, tens, hundreds, multipliers);
      const tokens = text.replace(/ØŒ/g," ").replace(/ Ùˆ /g," ").trim().split(/\s+/);

      let resultWords = [];
      let numberBuffer = [];

      function processBuffer(buffer) {
        let total = 0, current = 0;
        buffer.forEach(word => {
          if (teens[word] !== undefined) current += teens[word];
          else if (units[word] !== undefined) current += units[word];
          else if (tens[word] !== undefined) current += tens[word];
          else if (hundreds[word] !== undefined) current += hundreds[word];
          else if (multipliers[word] !== undefined) {
            if (multipliers[word] >= 1000) {
              current = (current === 0 ? 1 : current) * multipliers[word];
              total += current;
              current = 0;
            } else {
              current *= multipliers[word];
            }
          }
        });
        total += current;
        return total;
      }

      for (let i = 0; i < tokens.length; i++) {
        const word = tokens[i];
        const twoWords = word + " " + (tokens[i+1] || "");
        if (teens[twoWords]) {
          numberBuffer.push(twoWords);
          i++;
          continue;
        }

        if (allWords[word]) {
          numberBuffer.push(word);
        } else {
          if (numberBuffer.length > 0) {
            const num = processBuffer(numberBuffer);
            if (num !== null) resultWords.push(num.toString());
            numberBuffer = [];
          }
          resultWords.push(word);
        }
      }

      if (numberBuffer.length > 0) {
        const num = processBuffer(numberBuffer);
        if (num !== null) resultWords.push(num.toString());
      }

      return resultWords.join(" ");
    }

    // ğŸš€ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªÙˆØ§Ø±ÙŠØ®
    function formatArabicDate(text) {
      const months = {
        "ÙŠÙ†Ø§ÙŠØ±": 1, "ÙƒØ§Ù†ÙˆÙ†": 1, "ÙƒØ§Ù†ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ": 1,
        "ÙØ¨Ø±Ø§ÙŠØ±": 2, "Ø´Ø¨Ø§Ø·": 2,
        "Ù…Ø§Ø±Ø³": 3, "Ø¢Ø°Ø§Ø±": 3,
        "Ø§Ø¨Ø±ÙŠÙ„": 4, "Ø£Ø¨Ø±ÙŠÙ„": 4, "Ù†ÙŠØ³Ø§Ù†": 4,
        "Ù…Ø§ÙŠÙˆ": 5, "Ø£ÙŠØ§Ø±": 5,
        "ÙŠÙˆÙ†ÙŠÙˆ": 6, "Ø­Ø²ÙŠØ±Ø§Ù†": 6,
        "ÙŠÙˆÙ„ÙŠÙˆ": 7, "ØªÙ…ÙˆØ²": 7,
        "Ø§ØºØ³Ø·Ø³": 8, "Ø£ØºØ³Ø·Ø³": 8, "Ø¢Ø¨": 8,
        "Ø³Ø¨ØªÙ…Ø¨Ø±": 9, "Ø§ÙŠÙ„ÙˆÙ„": 9,
        "Ø£ÙƒØªÙˆØ¨Ø±": 10, "Ø§ÙƒØªÙˆØ¨Ø±": 10, "ØªØ´Ø±ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„": 10,
        "Ù†ÙˆÙÙ…Ø¨Ø±": 11, "ØªØ´Ø±ÙŠÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ": 11,
        "Ø¯ÙŠØ³Ù…Ø¨Ø±": 12, "ÙƒØ§Ù†ÙˆÙ† Ø§Ù„Ø£ÙˆÙ„": 12
      };

      let words = text.split(/\s+/);
      let numbers = words.filter(w => !isNaN(w)).map(n => parseInt(n));
      let day = null, month = null, year = null;

      for (let i = 0; i < words.length; i++) {
        if (months[words[i]]) {
          month = months[words[i]];
        }
      }

      if (numbers.length >= 3) {
        year = numbers.find(n => n > 1900);
        if (year) {
          let rest = numbers.filter(n => n !== year);
          if (rest.length >= 2) {
            day = Math.min(...rest);
            month = Math.max(...rest);
          }
        }
      }

      if (numbers.length === 2 && month) {
        day = numbers[0];
        year = numbers[1];
      }

      if (numbers.length === 2 && !month) {
        day = numbers[0];
        month = numbers[1];
      }

      if (!year) {
        for (let n of numbers) {
          if (n > 1900) {
            year = n;
          }
        }
      }

      if (day && month && year) {
        return `${year}/${month.toString().padStart(2,"0")}/${day.toString().padStart(2,"0")}`;
      }

      return text;
    }

    function startRecognition(){
      const SpeechRecognition=window.webkitSpeechRecognition;
      if(!SpeechRecognition){alert("âŒ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØªØ¹Ù…Ù„ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ù…ØªØµÙØ­ Chrome.");return;}
      recognition=new SpeechRecognition();
      recognition.lang='ar-IQ';
      recognition.interimResults=false;

      recognition.onstart=function(){
        document.querySelector(".container").classList.add("recording");
        document.getElementById("recordingIndicator").style.display="block";
        document.getElementById("startBtn").style.display="none";
        document.getElementById("stopBtn").style.display="inline-block";
      }

      recognition.onresult=function(event){
        const transcript=event.results[0][0].transcript;
        let converted=wordsToNumbersInText(transcript);
        converted=formatArabicDate(converted); // âœ… Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®

        document.getElementById("output").innerText=converted;

        const history=document.getElementById("history");
        history.value += converted + "\n";
        let lines = history.value.split("\n");
        if(lines.length > 10){
          lines = lines.slice(lines.length-10);
          history.value = lines.join("\n");
        }

        navigator.clipboard.writeText(converted).catch(()=>{});
      }

      recognition.onend=function(){
        document.querySelector(".container").classList.remove("recording");
        document.getElementById("recordingIndicator").style.display="none";
        document.getElementById("startBtn").style.display="inline-block";
        document.getElementById("stopBtn").style.display="none";
      }

      recognition.start();
    }

    function stopRecognition(){
      if(recognition){
        recognition.stop();
      }
    }
  </script>
</body>
</html>
