<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Convert audio</title>
<style>
/* === التنسيقات كما في كودك === */
body{margin:0;padding:0;background-color:#000;color:#fff;font-family:Tahoma,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column}.login-container{background-color:#111;padding:30px;border-radius:12px;box-shadow:0 0 20px rgba(255,255,255,0.15);text-align:center;width:90%;max-width:400px;display:none}.login-container h2{margin-bottom:20px;font-size:22px;color:#ffcc00}.login-container input{width:90%;padding:12px;margin:10px 0;border-radius:8px;border:1px solid #444;background-color:#1a1a1a;color:#fff;font-size:16px;text-align:center;direction:ltr;unicode-bidi:embed}.login-container label{font-size:14px;display:inline-block;align-items:center;justify-content:center;gap:1px;margin-top:10px;cursor:pointer;width:-55℅;text-align:center;position:relative;top:11px}.login-container button{padding:12px 24px;font-size:18px;margin-top:15px;border:none;border-radius:8px;background-color:#4CAF50;color:white;cursor:pointer;transition:0.3s}.login-container button:hover{opacity:0.85}.container{background-color:#111;padding:30px;border-radius:12px;box-shadow:0 0 20px rgba(255,255,255,0.1);text-align:center;width:90%;max-width:600px;transition:all 0.3s ease;display:none;position:relative}h1{margin-bottom:20px;font-size:24px;transition:font-size 0.3s ease}button{padding:12px 24px;font-size:18px;margin:10px 5px;border:none;border-radius:8px;cursor:pointer;transition:0.3s,font-size 0.3s ease,padding 0.3s ease}#startBtn{background-color:#4CAF50;color:white}#stopBtn{background-color:#f44336;color:white;display:none}button:hover{opacity:0.85}#recordingIndicator{display:none;color:#ff5252;font-weight:bold;margin-top:10px}#recordingDot{display:inline-block;width:12px;height:12px;background-color:red;border-radius:50%;margin-left:8px;animation:blink 1s infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}#output{background:#222;border:1px solid #444;padding:15px;border-radius:8px;margin-top:20px;font-size:18px;min-height:80px;white-space:pre-wrap;color:#ddd;transition:font-size 0.3s ease,padding 0.3s ease;direction:ltr;unicode-bidi:embed;text-align:center}textarea#history{text-align:left;max-height:150px;overflow-y:auto;margin-top:10px;color:#aaa;font-size:14px;width:96%;padding:12px;border-radius:6px;border:1px solid #555;background-color:#1a1a1a;direction:ltr;unicode-bidi:embed}textarea{width:96%;margin-top:15px;padding:12px;font-size:16px;border-radius:6px;border:1px solid #555;background-color:#1a1a1a;color:#fff;resize:vertical;transition:font-size 0.3s ease,padding 0.3s ease}#userCountContainer{position:relative;top:-22px;left:15px;right:15px;display:flex;align-items:center;font-size:12px;opacity:0.8;justify-content:space-between}#userCount{color:#0f0}#logoutBtn{font-size:12px;padding:4px 8px;border-radius:6px;border:none;background-color:#f44336;color:white;cursor:pointer;opacity:0.9}footer{margin-top:15px;font-size:14px;color:#b17215;text-align:center}@keyframes rgbGlow{0%{box-shadow:0 0 40px 15px rgba(255,0,0,0.25)}20%{box-shadow:0 0 40px 15px rgba(255,165,0,0.25)}40%{box-shadow:0 0 40px 15px rgba(0,255,0,0.25)}60%{box-shadow:0 0 40px 15px rgba(0,255,255,0.25)}80%{box-shadow:0 0 40px 15px rgba(0,0,255,0.25)}100%{box-shadow:0 0 40px 15px rgba(255,0,255,0.25)}}.container.recording{animation:rgbGlow 10s infinite linear}@media (max-width:500px){.container{padding:20px}.container h1{font-size:20px}button{font-size:16px;padding:10px 18px}#output{font-size:16px;padding:12px}textarea{font-size:14px;padding:10px}}@media (max-width:350px){.container{padding:15px}.container h1{font-size:18px}button{font-size:14px;padding:8px 16px}#output{font-size:14px;padding:10px}textarea{font-size:13px;padding:8px}}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDa1_gisk5GuTvRzACp0lA1TGe3-b2Sz8A",
  authDomain: "dragon-tv-3e8c1.firebaseapp.com",
  databaseURL: "https://dragon-tv-3e8c1-default-rtdb.firebaseio.com",
  projectId: "dragon-tv-3e8c1",
  storageBucket: "dragon-tv-3e8c1.firebasestorage.app",
  messagingSenderId: "909817368695",
  appId: "1:909817368695:web:b5e9ffccafefcbc41a7672"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>
</head>
<body>
<div class="login-container" id="login">
<h2>⟱ تسجيل الدخول ⟱</h2>
<input type="text" id="username" placeholder="اسم المستخدم">
<input type="password" id="password" placeholder="كلمة المرور">
<label><input type="checkbox" id="rememberMe">ذكرني</label>
<button onclick="checkLogin()">دخول</button>
<p id="error" style="color:red; display:none;">!! خطأ في اسم المستخدم أو كلمة المرور</p>
</div>

<div class="container" id="app">
<div id="userCountContainer">
  <div id="userCount"># الأعضاء: 0</div>
  <button id="logoutBtn" onclick="logout()">تسجيل خروج</button>
</div>

<h1> [ Convert Audio To Text In Iraqi ]</h1><br>
<button id="startBtn" onclick="startRecognition()">[▶︎] بدء التسجيل</button>
<button id="stopBtn" onclick="stopRecognition()">[X] إيقاف التسجيل</button>

<div id="recordingIndicator">
  <span id="recordingDot"></span> ▶︎ جاري التسجيل...
</div>

<div id="output"></div>

<!-- بداية حاوية history مع أزرار النسخ -->
<div id="historyContainer" style="position:relative;width:96%;max-width:600px;margin-top:10px;">
  <button id="toggleLayoutBtn" style="position:absolute;top:5px;left:5px;padding:4px 8px;font-size:12px;">↕</button>
  <button id="copyAllBtn" style="position:absolute;top:5px;right:5px;padding:4px 8px;font-size:12px;">نسخ الكل</button>
  <textarea id="history" rows="6" readonly></textarea>
</div>
<!-- نهاية حاوية history -->

<footer>
  &copy; DRAGON&CHEAT 2025 @
</footer>
</div>

<script>
// === دوال تسجيل الدخول وFirebase كما هي ===
function base64EncodeUnicode(str){return btoa(unescape(encodeURIComponent(str)));}
const deviceId = crypto.randomUUID();
function updateUserOnlineStatus(username,online){const ref=db.ref('onlineUsers/'+username+'/'+deviceId);if(online){ref.set(true);ref.onDisconnect().remove();}else{ref.remove();db.ref('onlineUsers/'+username).once('value',snap=>{if(!snap.exists()){db.ref('onlineUsers/'+username).remove();}});}}
db.ref('onlineUsers').on('value',snapshot=>{document.getElementById("userCount").textContent="# الأعضاء: "+snapshot.numChildren();});
function checkLogin(){const user=document.getElementById("username").value.trim();const pass=document.getElementById("password").value.trim();const remember=document.getElementById("rememberMe").checked;const encodedUser="2LnZhNin2KE=";const encodedPass="MjI0NA==";if(base64EncodeUnicode(user)===encodedUser && base64EncodeUnicode(pass)===encodedPass){if(remember)localStorage.setItem("loggedIn","true");else sessionStorage.setItem("loggedInSession","true");document.getElementById("login").style.display="none";document.getElementById("app").style.display="block";updateUserOnlineStatus(user,true);window.addEventListener("beforeunload",()=>updateUserOnlineStatus(user,false));}else{document.getElementById("error").style.display="block";}}
function logout(){const user=document.getElementById("username").value.trim();updateUserOnlineStatus(user,false);localStorage.removeItem("loggedIn");sessionStorage.removeItem("loggedInSession");document.getElementById("app").style.display="none";document.getElementById("login").style.display="block";}
window.onload=function(){const loggedInPermanent=localStorage.getItem("loggedIn")==="true";const loggedInSession=sessionStorage.getItem("loggedInSession")==="true";if(loggedInPermanent && !loggedInSession){alert("√ سيتم تسجيل الدخول تلقائيًا الآن...");sessionStorage.setItem("loggedInSession","true");location.reload();return;}if(loggedInPermanent||loggedInSession){const user=document.getElementById("username").value.trim();document.getElementById("login").style.display="none";document.getElementById("app").style.display="block";updateUserOnlineStatus(user,true);window.addEventListener("beforeunload",()=>updateUserOnlineStatus(user,false));}else{document.getElementById("login").style.display="block";}}
</script>

<script>
// === التعرف الصوتي + تحويل الكلمات إلى أرقام مع عكس كل رقم ===
// (دوال wordsToNumbersInText, extractDateFromText, startRecognition, stopRecognition كما هي)
// ... [كودك السابق كما هو بدون تغيير] ...

// === أزرار ونسخ history ===
const historyTextarea = document.getElementById('history');
const toggleLayoutBtn = document.getElementById('toggleLayoutBtn');
const copyAllBtn = document.getElementById('copyAllBtn');

let isHorizontal = false;

// تبديل العرض بين عمودي وأفقي
toggleLayoutBtn.addEventListener('click', () => {
  if (!isHorizontal) {
    historyTextarea.style.whiteSpace = 'pre';
    historyTextarea.style.display = 'flex';
    historyTextarea.style.flexDirection = 'row';
    historyTextarea.style.flexWrap = 'wrap';
    historyTextarea.style.gap = '10px';
    historyTextarea.style.height = 'auto';
    historyTextarea.style.overflowY = 'hidden';
  } else {
    historyTextarea.style.whiteSpace = 'pre-wrap';
    historyTextarea.style.display = 'block';
    historyTextarea.style.flexDirection = 'column';
    historyTextarea.style.height = '150px';
    historyTextarea.style.overflowY = 'auto';
  }
  isHorizontal = !isHorizontal;
});

// نسخ السطر بالكامل عند الضغط على أي مكان داخل textarea
historyTextarea.addEventListener('click', (e) => {
  const selectionStart = historyTextarea.selectionStart;
  const text = historyTextarea.value;
  const lines = text.split('\n');

  let start = 0, end = 0;
  for (let line of lines) {
    end = start + line.length;
    if (selectionStart >= start && selectionStart <= end) {
      navigator.clipboard.writeText(line.trim()).then(() => {
        alert("✅ تم نسخ: " + line.trim());
      });
      break;
    }
    start = end + 1; // +1 لتجاوز حرف الـ newline
  }
});

// نسخ الكل
copyAllBtn.addEventListener('click', () => {
  navigator.clipboard.writeText(historyTextarea.value).then(() => {
    alert("✅ تم نسخ الكل");
  });
});
</script>

</body>
</html>
