<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Convert audio</title>
<style>
/* === كل التنسيقات كما هي في كلا الكودين === */
body{
    margin:0;
    padding:0;
    background-color:#000;
    color:#fff;
    font-family:Tahoma,sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    flex-direction:column
}
.login-container{
    background-color:#111;
    padding:30px;
    border-radius:12px;
    box-shadow:0 0 20px rgba(255,255,255,0.15);
    text-align:center;
    width:90%;
    max-width:400px;
    display:none
}
.login-container h2{
    margin-bottom:20px;
    font-size:22px;
    color:#ffcc00
}
.login-container input{
    width:90%;
    padding:12px;
    margin:10px 0;
    border-radius:8px;
    border:1px solid #444;
    background-color:#1a1a1a;
    color:#fff;
    font-size:16px;
    text-align:center;
    direction:ltr;
    unicode-bidi:embed
}
.login-container label{
    font-size:14px;
    display:inline-block;
    align-items:center;
    justify-content:center;
    gap:1px;
    margin-top:10px;
    cursor:pointer;
    width:-55℅;
    text-align:center;
    position:relative;
    top:11px
}
.login-container button{
    padding:12px 24px;
    font-size:18px;
    margin-top:15px;
    border:none;
    border-radius:8px;
    background-color:#4CAF50;
    color:white;
    cursor:pointer;
    transition:0.3s
}
.login-container button:hover{opacity:0.85}
.container{
    background-color:#111;
    padding:30px;
    border-radius:12px;
    box-shadow:0 0 20px rgba(255,255,255,0.1);
    text-align:center;
    width:90%;
    max-width:600px;
    transition:all 0.3s ease;
    display:none;
    position:relative
}
h1{
    margin-bottom:20px;
    font-size:24px;
    transition:font-size 0.3s ease
}
button{
    padding:12px 24px;
    font-size:18px;
    margin:10px 5px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    transition:0.3s,font-size 0.3s ease,padding 0.3s ease
}
#startBtn{background-color:#4CAF50;color:white}
#stopBtn{background-color:#f44336;color:white;display:none}
button:hover{opacity:0.85}
#recordingIndicator{
    display:none;
    color:#ff5252;
    font-weight:bold;
    margin-top:10px
}
#recordingDot{
    display:inline-block;
    width:12px;
    height:12px;
    background-color:red;
    border-radius:50%;
    margin-left:8px;
    animation:blink 1s infinite
}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
#output{
    background:#222;
    border:1px solid #444;
    padding:15px;
    border-radius:8px;
    margin-top:20px;
    font-size:18px;
    min-height:80px;
    white-space:pre-wrap;
    color:#ddd;
    transition:font-size 0.3s ease,padding 0.3s ease;
    direction:ltr;
    unicode-bidi:embed;
    text-align:center;
    position:relative
}
textarea{
    width:96%;
    margin-top:15px;
    padding:12px;
    font-size:16px;
    border-radius:6px;
    border:1px solid #555;
    background-color:#1a1a1a;
    color:#fff;
    resize:vertical;
    transition:font-size 0.3s ease,padding 0.3s ease
}
#userCountContainer{
    position:relative;
    top:-22px;
    left:15px;
    right:15px;
    display:flex;
    align-items:center;
    font-size:12px;
    opacity:0.8;
    justify-content:space-between
}
#userCount{color:#0f0}
#logoutBtn{
    font-size:12px;
    padding:4px 8px;
    border-radius:6px;
    border:none;
    background-color:#f44336;
    color:white;
    cursor:pointer;
    opacity:0.9
}
footer{
    margin-top:15px;
    font-size:14px;
    color:#b17215;
    text-align:center
}
@keyframes rgbGlow{
0%{box-shadow:0 0 40px 15px rgba(255,0,0,0.25)}
20%{box-shadow:0 0 40px 15px rgba(255,165,0,0.25)}
40%{box-shadow:0 0 40px 15px rgba(0,255,0,0.25)}
60%{box-shadow:0 0 40px 15px rgba(0,255,255,0.25)}
80%{box-shadow:0 0 40px 15px rgba(0,0,255,0.25)}
100%{box-shadow:0 0 40px 15px rgba(255,0,255,0.25)}
}
.container.recording{animation:rgbGlow 10s infinite linear}
#smartWordsBtn{position:absolute;top:5px;left:5px;padding:4px 8px;font-size:12px;background-color:#564d4d;color:#fff;border:none;border-radius:4px;cursor:pointer;z-index:20}
#smartWordsMenu{position:absolute;top:30px;left:5px;background:#222;border:1px solid #555;border-radius:6px;padding:6px;display:none;flex-direction:column;gap:4px;z-index:21}
.smartWordItem{display:flex;justify-content:space-between;align-items:center;background:#333;padding:2px 6px;border-radius:4px;cursor:pointer}
.smartWordItem span{flex:1;text-align:center}
.smartWordItem button{background:red;color:#fff;border:none;border-radius:4px;padding:0 4px;margin-left:4px;cursor:pointer}
#smartAddInput{display:flex;gap:4px;margin-bottom:4px}
#smartAddInput input{flex:1;padding:4px;border-radius:4px;border:1px solid #555;background:#111;color:#fff;font-size:14px}
#smartAddInput button{padding:4px 8px;border-radius:4px;border:none;background:#4CAF50;color:#fff;font-size:12px;cursor:pointer}
@media (max-width:500px){
    .container{padding:20px}
    .container h1{font-size:20px}
    button{font-size:16px;padding:10px 18px}
    #output{font-size:16px;padding:12px}
    textarea{font-size:14px;padding:10px}
}
@media (max-width:350px){
    .container{padding:15px}
    .container h1{font-size:18px}
    button{font-size:14px;padding:8px 16px}
    #output{font-size:14px;padding:10px}
    textarea{font-size:13px;padding:8px}
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDa1_gisk5GuTvRzACp0lA1TGe3-b2Sz8A",
  authDomain: "dragon-tv-3e8c1.firebaseapp.com",
  databaseURL: "https://dragon-tv-3e8c1-default-rtdb.firebaseio.com",
  projectId: "dragon-tv-3e8c1",
  storageBucket: "dragon-tv-3e8c1.firebasestorage.app",
  messagingSenderId: "909817368695",
  appId: "1:909817368695:web:b5e9ffccafefcbc41a7672"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>
</head>

<body>
<div class="login-container" id="login">
<h2>⟱ تسجيل الدخول ⟱</h2>
<input type="text" id="username" placeholder="اسم المستخدم">
<input type="password" id="password" placeholder="كلمة المرور">
<label><input type="checkbox" id="rememberMe">ذكرني</label>
<button onclick="checkLogin()">دخول</button>
<p id="error" style="color:red; display:none;">!! خطأ في اسم المستخدم أو كلمة المرور</p>
</div>

<div class="container" id="app">
<div id="userCountContainer">
<div id="userCount"># الأعضاء: 0</div>
<button id="logoutBtn" onclick="logout()">تسجيل خروج</button>
</div>

<h1> [ Convert Audio To Text In Iraqi ]</h1><br>
<button id="startBtn" onclick="startRecognition()">[▶︎] بدء التسجيل</button>
<button id="stopBtn" onclick="stopRecognition()">[X] إيقاف التسجيل</button>

<div id="recordingIndicator">
<span id="recordingDot"></span> ▶︎ جاري التسجيل...
</div>

<div id="output">
<button id="smartWordsBtn">كلمات ذكية</button>
<div id="smartWordsMenu">
<div id="smartAddInput">
<input type="text" id="newSmartWord" placeholder="أدخل كلمة خاطئة,ثم صححها">
<button onclick="addSmartWord()">إضافة</button>
</div>
<div id="smartWordsList"></div>
<button onclick="toggleSmartMenu()" style="margin-top:4px;padding:2px 6px;background:#444;color:#fff;border:none;border-radius:4px;font-size:12px;">إغلاق القائمة</button>
</div>
</div>

<div id="historyContainer" style="width:96%; min-height:110px; max-height:200px; border:1px solid #555; border-radius:6px; background:#1a1a1a; top:18px; position:relative; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:4px; flex-wrap:wrap;">
<button id="toggleHistoryBtn" title="تبديل العرض" style="background-color: #564d4d; position:absolute;top:5px;left:5px;padding:4px 8px;font-size:12px; z-index:10;">⇄</button>
<button id="copyAllHistoryBtn" title="نسخ الكل" style="background-color: #564d4d; position:absolute;top:5px;right:5px;padding:4px 8px;font-size:12px; z-index:10;">نسخ الكل</button>
<div id="history" style="width:100%; display:flex; flex-direction:column; gap:4px; flex-wrap:wrap; align-items:center; justify-content:flex-start; text-align:center;"></div>
</div><br>

<footer>&copy; DRAGON&CHEAT 2025 @</footer>

<!-- زر الاستعلام دائري أصغر أسفل الفوتر -->
<div style="position: relative; width: 100%; display: flex; justify-content: flex-start;">
<button id="helpBtn" title="تعليمات" style="width: 0px; height: 0px; border-radius: 50%; border: none; background-color: rgba(205, 163, 69, 0.1); color: #000; font-weight: bold; font-size: 16px; cursor: pointer; box-shadow: 0 0 10px rgba(); transition: all 0.3s ease; margin-left: 20px;"></button>
</div>

<!-- نافذة التعليمات -->
<div id="helpModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 400px; background-color: #111; color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 20px rgba(255,255,255,0.3); text-align: center; z-index: 10000;">
<h3>تعليمات الاستخدام</h3>
<p>
0. يجب ان يتوفر لديك مكرفون واضح وأنترنت مستقر <br>
1. اضغط على زر ▶︎ لبدء التسجيل الصوتي.<br>
2. اضغط على زر X لإيقاف التسجيل.<br>
3. سيتم تحويل كلام إلى أرقام لاتنعكس لو تكلمت بها بصورة مستقلة لأنها ارقام لاتينية ليست عربية.<br>
4. يمكنك نسخ النتائج من صندوق التاريخ.<br>
5. لتسجيل الدخول، أدخل اسم المستخدم وكلمة المرور. <br>
®جميع حقوق محفوظة™
</p>
<button onclick="helpModal.style.display='none'" style="margin-top:15px;padding:8px 16px;border:none;border-radius:8px;background-color:#4CAF50;color:white;cursor:pointer;">إغلاق</button>
</div>

<script>
// === كل دوال كودك الثاني كما هي ===
function base64EncodeUnicode(str){return btoa(unescape(encodeURIComponent(str)));}
const deviceId = crypto.randomUUID();
function updateUserOnlineStatus(username,online){
    const ref=db.ref('onlineUsers/'+username+'/'+deviceId);
    if(online){ref.set(true);ref.onDisconnect().remove();}
    else{
        ref.remove();
        db.ref('onlineUsers/'+username).once('value',snap=>{if(!snap.exists()){db.ref('onlineUsers/'+username).remove();}});
    }
}
db.ref('onlineUsers').on('value',snapshot=>{
    document.getElementById("userCount").textContent="# الأعضاء: "+snapshot.numChildren();
});
function checkLogin(){
    const user=document.getElementById("username").value.trim();
    const pass=document.getElementById("password").value.trim();
    const remember=document.getElementById("rememberMe").checked;
    const encodedUser="2LnZhNin2KE=";
    const encodedPass="MjI0NA==";
    if(base64EncodeUnicode(user)===encodedUser && base64EncodeUnicode(pass)===encodedPass){
        if(remember)localStorage.setItem("loggedIn","true");
        else sessionStorage.setItem("loggedInSession","true");
        document.getElementById("login").style.display="none";
        document.getElementById("app").style.display="block";
        updateUserOnlineStatus(user,true);
        window.addEventListener("beforeunload",()=>updateUserOnlineStatus(user,false));
    }else{document.getElementById("error").style.display="block";}
}
function logout(){
    const user=document.getElementById("username").value.trim();
    updateUserOnlineStatus(user,false);
    localStorage.removeItem("loggedIn");
    sessionStorage.removeItem("loggedInSession");
    document.getElementById("app").style.display="none";
    document.getElementById("login").style.display="block";
}
window.onload=function(){
    const loggedInPermanent=localStorage.getItem("loggedIn")==="true";
    const loggedInSession=sessionStorage.getItem("loggedInSession")==="true";
    if(loggedInPermanent && !loggedInSession){
        alert("√ سيتم تسجيل الدخول تلقائيًا الآن...");
        sessionStorage.setItem("loggedInSession","true");
        location.reload();
        return;
    }
    if(loggedInPermanent||loggedInSession){
        const user=document.getElementById("username").value.trim();
        document.getElementById("login").style.display="none";
        document.getElementById("app").style.display="block";
        updateUserOnlineStatus(user,true);
        window.addEventListener("beforeunload",()=>updateUserOnlineStatus(user,false));
    }else{
        document.getElementById("login").style.display="block";
    }
}
</script>

<script>
// === التعرف الصوتي + تحويل الكلمات إلى أرقام + تاريخ ===
let recognition;
let smartWords = {};

function wordsToNumbersInText(text){
    const units={"صفر":0,"واحد":1,"واحدة":1,"احد":1,"احدى":1,"اثنان":2,"اثنين":2,"اثنتان":2,"اثنتين":2,"ثنين":2,"ثلاثة":3,"ثلاث":3,"اربعة":4,"أربعة":4,"خمسة":5,"ستة":6,"ست":6,"سبعة":7,"ثمانية":8,"تسعة":9,"عشرة":10};
    return text.replace(/\b(صفر|واحد|واحدة|احد|احدى|اثنان|اثنين|اثنتان|اثنتين|ثنين|ثلاثة|ثلاث|اربعة|أربعة|خمسة|ستة|ست|سبعة|ثمانية|تسعة|عشرة)\b/g,m=>units[m]||m);
}

function extractDateFromText(text){
    const d=text.match(/\b\d{1,2}[\/.-]\d{1,2}[\/.-]\d{2,4}\b/g);
    return d?d.join(", "):"";
}

function startRecognition(){
    recognition = new (window.SpeechRecognition||window.webkitSpeechRecognition)();
    recognition.lang="ar-IQ";
    recognition.continuous=true;
    recognition.interimResults=false;
    recognition.onstart=()=>{document.getElementById("recordingIndicator").style.display="block";document.getElementById("startBtn").style.display="none";document.getElementById("stopBtn").style.display="inline-block";document.querySelector(".container").classList.add("recording");};
    recognition.onresult=e=>{
        let text=Array.from(e.results).map(r=>r[0].transcript).join(" ");
        text=wordsToNumbersInText(text);
        document.getElementById("output").textContent=text;
        const dateFound=extractDateFromText(text);
        if(dateFound)console.log("تاريخ تم التعرف عليه: "+dateFound);
    };
    recognition.start();
}

function stopRecognition(){
    if(recognition){recognition.stop();}
    document.getElementById("recordingIndicator").style.display="none";
    document.getElementById("startBtn").style.display="inline-block";
    document.getElementById("stopBtn").style.display="none";
    document.querySelector(".container").classList.remove("recording");
}

// === كلمات ذكية ===
function toggleSmartMenu(){const menu=document.getElementById("smartWordsMenu");menu.style.display=(menu.style.display==="flex")?"none":"flex";}
function addSmartWord(){const input=document.getElementById("newSmartWord");if(!input.value.includes(",")){alert("يرجى استخدام الفاصلة للفصل بين الخطأ والتصحيح");return;}const [wrong,right]=input.value.split(",").map(s=>s.trim());if(!wrong||!right)return;smartWords[wrong]=right;input.value="";renderSmartWords();}
function renderSmartWords(){const list=document.getElementById("smartWordsList");list.innerHTML="";for(let w in smartWords){const div=document.createElement("div");div.className="smartWordItem";div.innerHTML=`<span>${w} → ${smartWords[w]}</span><button onclick="deleteSmartWord('${w}')">حذف</button>`;list.appendChild(div);}}
function deleteSmartWord(word){delete smartWords[word];renderSmartWords();}
</script>
</body>
</html>
