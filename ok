<button onclick="startVoiceAndCopy()">ğŸ¤ ØªØ­Ø¯Ø« ÙˆØ³ÙŠØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ</button>

<div id="output" style="border:1px solid #ccc; padding:10px; margin-top:10px; min-height:50px; white-space: pre-wrap;"></div>

<script>
  function wordsToNumbersInText(text) {
    const numberWords = {
      "ØµÙØ±": 0, "ÙˆØ§Ø­Ø¯": 1, "ÙˆØ§Ø­Ø¯Ø©": 1, "Ø§Ø«Ù†Ø§Ù†": 2, "Ø§Ø«Ù†ÙŠÙ†": 2, "Ø§Ø«Ù†ØªØ§Ù†": 2, "Ø§Ø«Ù†ØªÙŠÙ†": 2,
      "Ø«Ù„Ø§Ø«Ø©": 3, "Ø£Ø±Ø¨Ø¹Ø©": 4, "Ø§Ø±Ø¨Ø¹Ø©":4, "Ø®Ù…Ø³Ø©": 5, "Ø³ØªØ©": 6, "Ø³Ø¨Ø¹Ø©": 7, "Ø«Ù…Ø§Ù†ÙŠØ©": 8, "ØªØ³Ø¹Ø©": 9,
      "Ø¹Ø´Ø±Ø©": 10, "Ø£Ø­Ø¯ Ø¹Ø´Ø±": 11, "Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±": 12, "Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±": 13, "Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±": 14, "Ø®Ù…Ø³Ø© Ø¹Ø´Ø±": 15,
      "Ø³ØªØ© Ø¹Ø´Ø±": 16, "Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±": 17, "Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±": 18, "ØªØ³Ø¹Ø© Ø¹Ø´Ø±": 19,
      "Ø¹Ø´Ø±ÙˆÙ†": 20, "Ø«Ù„Ø§Ø«ÙˆÙ†": 30, "Ø£Ø±Ø¨Ø¹ÙˆÙ†": 40, "Ø®Ù…Ø³ÙˆÙ†": 50, "Ø³ØªÙˆÙ†": 60,
      "Ø³Ø¨Ø¹ÙˆÙ†": 70, "Ø«Ù…Ø§Ù†ÙˆÙ†": 80, "ØªØ³Ø¹ÙˆÙ†": 90,
      "Ù…Ø§Ø¦Ø©": 100, "Ù…Ø¦Ø©": 100, "Ù…Ø¦ØªØ§Ù†": 200, "Ø«Ù„Ø§Ø«Ù…Ø§Ø¦Ø©": 300, "Ø£Ø±Ø¨Ø¹Ù…Ø§Ø¦Ø©": 400,
      "Ø®Ù…Ø³Ù…Ø§Ø¦Ø©": 500, "Ø³ØªÙ…Ø§Ø¦Ø©": 600, "Ø³Ø¨Ø¹Ù…Ø§Ø¦Ø©": 700, "Ø«Ù…Ø§Ù†Ù…Ø§Ø¦Ø©": 800, "ØªØ³Ø¹Ù…Ø§Ø¦Ø©": 900,
      "Ø£Ù„Ù": 1000, "Ø§Ù„Ù": 1000, "Ø£Ù„ÙØ§Ù†": 2000, "Ø¢Ù„Ø§Ù": 3000
    };

    const multipliers = {
      "Ù…Ø§Ø¦Ø©": 100,
      "Ù…Ø¦Ø©": 100,
      "Ø£Ù„Ù": 1000,
      "Ø§Ù„Ù": 1000
    };

    text = text.replace(/ØŒ/g, " ");
    text = text.replace(/ Ùˆ /g, " ");

    const words = text.trim().split(/\s+/);

    let resultWords = [];
    let numberBuffer = [];

    function processNumberBuffer(buffer) {
      let total = 0;
      let current = 0;

      buffer.forEach(word => {
        word = word.toLowerCase();
        if (numberWords[word] !== undefined) {
          current += numberWords[word];
        } else if (multipliers[word] !== undefined) {
          if (current === 0) current = 1;
          current *= multipliers[word];
          total += current;
          current = 0;
        }
      });
      total += current;
      return total;
    }

    for (let i = 0; i < words.length; i++) {
      const word = words[i].toLowerCase();

      if (numberWords[word] !== undefined || multipliers[word] !== undefined) {
        numberBuffer.push(word);
      } else {
        if (numberBuffer.length > 0) {
          const num = processNumberBuffer(numberBuffer);
          resultWords.push(num.toString());
          numberBuffer = [];
        }
        resultWords.push(words[i]);
      }
    }
    if (numberBuffer.length > 0) {
      const num = processNumberBuffer(numberBuffer);
      resultWords.push(num.toString());
    }

    return resultWords.join(" ");
  }

  function startVoiceAndCopy() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ");
      return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = 'ar-SA';
    recognition.interimResults = true;
    recognition.maxAlternatives = 1;

    let finalTranscript = "";

    recognition.onresult = function(event) {
      let interimTranscript = "";
      for (let i = event.resultIndex; i < event.results.length; i++) {
        if (event.results[i].isFinal) {
          finalTranscript += event.results[i][0].transcript + " ";
        } else {
          interimTranscript += event.results[i][0].transcript;
        }
      }
      document.getElementById("output").innerText = finalTranscript + interimTranscript;
    };

    recognition.onerror = function(event) {
      alert("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø±Ù: " + event.error);
    };

    recognition.onend = function() {
      if (finalTranscript.trim().length === 0) {
        alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø£ÙŠ ÙƒÙ„Ø§Ù….");
        return;
      }
      const processedText = wordsToNumbersInText(finalTranscript.trim());
      navigator.clipboard.writeText(processedText).then(() => {
        alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ:\n" + processedText + "\nØ§Ø°Ù‡Ø¨ Ù„Ø£ÙŠ Ø­Ù‚Ù„ ÙˆØ§Ø¶ØºØ· Ctrl + V Ù„Ù„ØµÙ‚");
      });
    };

    recognition.start();
  }
</script>
